-- Ultimate Fly Script with Joystick
-- made by gay228

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Variables
local flySpeed = 50
local isFlying = false
local bodyVelocity = nil
local flyingConnection = nil
local joystickActive = false
local joystickDirection = Vector3.new(0, 0, 0)

-- Create main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltimateFlyGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = player:WaitForChild("PlayerGui")

-- Main control panel (left side)
local ControlPanel = Instance.new("Frame")
ControlPanel.Name = "ControlPanel"
ControlPanel.Size = UDim2.new(0, 280, 0, 200)
ControlPanel.Position = UDim2.new(0, 20, 0.5, -100)
ControlPanel.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
ControlPanel.BackgroundTransparency = 0.15
ControlPanel.BorderSizePixel = 0
ControlPanel.Active = true
ControlPanel.Draggable = true
ControlPanel.Parent = ScreenGui

-- Rounded corners
local PanelCorner = Instance.new("UICorner")
PanelCorner.CornerRadius = UDim.new(0, 20)
PanelCorner.Parent = ControlPanel

-- Shadow effect
local PanelShadow = Instance.new("UIStroke")
PanelShadow.Color = Color3.fromRGB(80, 120, 255)
PanelShadow.Thickness = 2
PanelShadow.Transparency = 0.5
PanelShadow.Parent = ControlPanel

-- Title
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundColor3 = Color3.fromRGB(40, 60, 150)
Title.BackgroundTransparency = 0.3
Title.Text = "ðŸ›¸ ULTIMATE FLY"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 22
Title.Font = Enum.Font.GothamBold
Title.Parent = ControlPanel

local MadeBy = Instance.new("TextLabel")
MadeBy.Name = "MadeBy"
MadeBy.Size = UDim2.new(1, 0, 0, 25)
MadeBy.Position = UDim2.new(0, 0, 0, 40)
MadeBy.BackgroundTransparency = 1
MadeBy.Text = "made by gay228"
MadeBy.TextColor3 = Color3.fromRGB(255, 100, 150)
MadeBy.TextSize = 16
MadeBy.Font = Enum.Font.Gotham
MadeBy.Parent = ControlPanel

-- Toggle button
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0.8, 0, 0, 50)
ToggleButton.Position = UDim2.new(0.1, 0, 0.35, 0)
ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
ToggleButton.Text = "ðŸ›¸ START FLYING"
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.TextSize = 18
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.Parent = ControlPanel

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 12)
ToggleCorner.Parent = ToggleButton

-- Speed controls
local SpeedFrame = Instance.new("Frame")
SpeedFrame.Name = "SpeedFrame"
SpeedFrame.Size = UDim2.new(0.8, 0, 0, 40)
SpeedFrame.Position = UDim2.new(0.1, 0, 0.65, 0)
SpeedFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
SpeedFrame.BackgroundTransparency = 0.5
SpeedFrame.Parent = ControlPanel

local SpeedCorner = Instance.new("UICorner")
SpeedCorner.CornerRadius = UDim.new(0, 10)
SpeedCorner.Parent = SpeedFrame

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Name = "SpeedLabel"
SpeedLabel.Size = UDim2.new(0.6, 0, 1, 0)
SpeedLabel.Position = UDim2.new(0, 0, 0, 0)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Text = "Speed: " .. flySpeed
SpeedLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
SpeedLabel.TextSize = 16
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.Parent = SpeedFrame

local SpeedUp = Instance.new("TextButton")
SpeedUp.Name = "SpeedUp"
SpeedUp.Size = UDim2.new(0.2, 0, 1, 0)
SpeedUp.Position = UDim2.new(0.6, 0, 0, 0)
SpeedUp.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
SpeedUp.Text = "+"
SpeedUp.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedUp.TextSize = 20
SpeedUp.Font = Enum.Font.GothamBold
SpeedUp.Parent = SpeedFrame

local SpeedDown = Instance.new("TextButton")
SpeedDown.Name = "SpeedDown"
SpeedDown.Size = UDim2.new(0.2, 0, 1, 0)
SpeedDown.Position = UDim2.new(0.8, 0, 0, 0)
SpeedDown.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
SpeedDown.Text = "-"
SpeedDown.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedDown.TextSize = 20
SpeedDown.Font = Enum.Font.GothamBold
SpeedDown.Parent = SpeedFrame

-- Info label
local InfoLabel = Instance.new("TextLabel")
InfoLabel.Name = "InfoLabel"
InfoLabel.Size = UDim2.new(1, 0, 0, 30)
InfoLabel.Position = UDim2.new(0, 0, 1, -30)
InfoLabel.BackgroundTransparency = 1
InfoLabel.Text = "Use joystick on right side to move"
InfoLabel.TextColor3 = Color3.fromRGB(150, 150, 200)
InfoLabel.TextSize = 14
InfoLabel.Font = Enum.Font.Gotham
InfoLabel.Parent = ControlPanel

-- JOYSTICK GUI (right side)
local JoystickFrame = Instance.new("Frame")
JoystickFrame.Name = "JoystickFrame"
JoystickFrame.Size = UDim2.new(0, 200, 0, 200)
JoystickFrame.Position = UDim2.new(1, -220, 0.5, -100)
JoystickFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
JoystickFrame.BackgroundTransparency = 0.3
JoystickFrame.BorderSizePixel = 0
JoystickFrame.Visible = false
JoystickFrame.Parent = ScreenGui

local JoystickCorner = Instance.new("UICorner")
JoystickCorner.CornerRadius = UDim.new(0, 100)
JoystickCorner.Parent = JoystickFrame

-- Joystick background circle
local JoystickBg = Instance.new("Frame")
JoystickBg.Name = "JoystickBg"
JoystickBg.Size = UDim2.new(0, 150, 0, 150)
JoystickBg.Position = UDim2.new(0.5, -75, 0.5, -75)
JoystickBg.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
JoystickBg.BackgroundTransparency = 0.5
JoystickBg.BorderSizePixel = 0
JoystickBg.Parent = JoystickFrame

local JoystickBgCorner = Instance.new("UICorner")
JoystickBgCorner.CornerRadius = UDim.new(0, 75)
JoystickBgCorner.Parent = JoystickBg

-- Joystick handle (movable part)
local JoystickHandle = Instance.new("Frame")
JoystickHandle.Name = "JoystickHandle"
JoystickHandle.Size = UDim2.new(0, 60, 0, 60)
JoystickHandle.Position = UDim2.new(0.5, -30, 0.5, -30)
JoystickHandle.BackgroundColor3 = Color3.fromRGB(80, 120, 255)
JoystickHandle.BorderSizePixel = 0
JoystickHandle.Parent = JoystickFrame

local HandleCorner = Instance.new("UICorner")
HandleCorner.CornerRadius = UDim.new(0, 30)
HandleCorner.Parent = JoystickHandle

local HandleGlow = Instance.new("UIStroke")
HandleGlow.Color = Color3.fromRGB(150, 180, 255)
HandleGlow.Thickness = 3
HandleGlow.Parent = JoystickHandle

-- Joystick center point
local CenterDot = Instance.new("Frame")
CenterDot.Name = "CenterDot"
CenterDot.Size = UDim2.new(0, 10, 0, 10)
CenterDot.Position = UDim2.new(0.5, -5, 0.5, -5)
CenterDot.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
CenterDot.BorderSizePixel = 0
CenterDot.Parent = JoystickFrame

local CenterCorner = Instance.new("UICorner")
CenterCorner.CornerRadius = UDim.new(0, 5)
CenterCorner.Parent = CenterDot

-- Joystick instruction
local JoystickLabel = Instance.new("TextLabel")
JoystickLabel.Name = "JoystickLabel"
JoystickLabel.Size = UDim2.new(1, 0, 0, 30)
JoystickLabel.Position = UDim2.new(0, 0, 1, -30)
JoystickLabel.BackgroundTransparency = 1
JoystickLabel.Text = "Drag to move â€¢ Release to stop"
JoystickLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
JoystickLabel.TextSize = 14
JoystickLabel.Font = Enum.Font.Gotham
JoystickLabel.Parent = JoystickFrame

-- Functions
local function updateSpeedDisplay()
    SpeedLabel.Text = "Speed: " .. flySpeed
end

local function updateToggleButton()
    if isFlying then
        ToggleButton.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        ToggleButton.Text = "ðŸ›¸ FLYING ON"
        JoystickFrame.Visible = true
        
        -- Fade in joystick
        JoystickFrame.BackgroundTransparency = 0.7
        local tween = TweenService:Create(JoystickFrame, TweenInfo.new(0.5), {BackgroundTransparency = 0.3})
        tween:Play()
    else
        ToggleButton.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
        ToggleButton.Text = "ðŸ›¸ START FLYING"
        JoystickFrame.Visible = false
    end
end

local function toggleFlight()
    if isFlying then
        -- Stop flying
        if bodyVelocity then
            bodyVelocity:Destroy()
            bodyVelocity = nil
        end
        if flyingConnection then
            flyingConnection:Disconnect()
            flyingConnection = nil
        end
        humanoid.PlatformStand = false
        isFlying = false
        joystickActive = false
        joystickDirection = Vector3.new(0, 0, 0)
        
        -- Reset joystick position
        JoystickHandle.Position = UDim2.new(0.5, -30, 0.5, -30)
    else
        -- Start flying
        humanoid.PlatformStand = true
        
        bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.MaxForce = Vector3.new(10000, 10000, 10000)
        bodyVelocity.P = 1000
        bodyVelocity.Parent = rootPart
        
        isFlying = true
        
        -- Flight physics loop
        flyingConnection = RunService.Heartbeat:Connect(function()
            if not bodyVelocity or not bodyVelocity.Parent then return end
            
            local camera = workspace.CurrentCamera
            
            -- Combine joystick movement with keyboard controls
            local moveDirection = joystickDirection
            
            -- Add keyboard controls (WASD)
            local lookVector = camera.CFrame.LookVector
            local rightVector = camera.CFrame.RightVector
            
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                moveDirection = moveDirection + lookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                moveDirection = moveDirection - lookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                moveDirection = moveDirection - rightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                moveDirection = moveDirection + rightVector
            end
            
            -- Vertical controls (Space/Shift)
            local vertical = 0
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                vertical = vertical + 1
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) or UserInputService:IsKeyDown(Enum.KeyCode.RightShift) then
                vertical = vertical - 1
            end
            
            -- Apply speed
            if moveDirection.Magnitude > 0 then
                moveDirection = moveDirection.Unit * flySpeed
            end
            
            -- Final velocity
            bodyVelocity.Velocity = Vector3.new(moveDirection.X, vertical * flySpeed, moveDirection.Z)
        end)
    end
    
    updateToggleButton()
end

-- Joystick control logic
local function updateJoystick(input)
    if not isFlying then return end
    
    local joystickCenter = JoystickBg.AbsolutePosition + JoystickBg.AbsoluteSize / 2
    local maxDistance = JoystickBg.AbsoluteSize.X / 2 - JoystickHandle.AbsoluteSize.X / 2
    
    local mousePos = Vector2.new(input.Position.X, input.Position.Y)
    local direction = mousePos - joystickCenter
    
    -- Limit joystick movement
    local distance = math.min(direction.Magnitude, maxDistance)
    local normalizedDirection = direction.Magnitude > 0 and direction.Unit or Vector2.new(0, 0)
    
    -- Update handle position
    local newPosition = joystickCenter + normalizedDirection * distance
    JoystickHandle.Position = UDim2.new(
        0, newPosition.X - JoystickFrame.AbsolutePosition.X - JoystickHandle.AbsoluteSize.X / 2,
        0, newPosition.Y - JoystickFrame.AbsolutePosition.Y - JoystickHandle.AbsoluteSize.Y / 2
    )
    
    -- Calculate movement direction (invert Y for intuitive controls)
    local x = normalizedDirection.X
    local y = -normalizedDirection.Y  -- Invert Y axis
    
    -- Convert to 3D movement based on camera
    local camera = workspace.CurrentCamera
    local lookVector = camera.CFrame.LookVector
    local rightVector = camera.CFrame.RightVector
    
    joystickDirection = (rightVector * x) + (lookVector * y)
    joystickActive = direction.Magnitude > 10
end

local function resetJoystick()
    joystickActive = false
    joystickDirection = Vector3.new(0, 0, 0)
    
    -- Animate handle back to center
    local tween = TweenService:Create(JoystickHandle, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Position = UDim2.new(0.5, -30, 0.5, -30)
    })
    tween:Play()
end

-- Button events
ToggleButton.MouseButton1Click:Connect(toggleFlight)

SpeedUp.MouseButton1Click:Connect(function()
    flySpeed = math.min(flySpeed + 10, 200)
    updateSpeedDisplay()
end)

SpeedDown.MouseButton1Click:Connect(function()
    flySpeed = math.max(flySpeed - 10, 10)
    updateSpeedDisplay()
end)

-- Joystick input handling
JoystickHandle.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        joystickActive = true
    end
end)

JoystickHandle.InputChanged:Connect(function(input)
    if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and joystickActive then
        updateJoystick(input)
    end
end)

JoystickHandle.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        resetJoystick()
    end
end)

-- Also allow dragging from joystick background
JoystickBg.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        joystickActive = true
        updateJoystick(input)
    end
end)

JoystickBg.InputChanged:Connect(function(input)
    if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) and joystickActive then
        updateJoystick(input)
    end
end)

JoystickBg.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        resetJoystick()
    end
end)

-- Close button
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 18
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = Title

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
    if isFlying then
        toggleFlight()
    end
end)

-- Initialize
updateSpeedDisplay()
updateToggleButton()

-- Load notification
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "ULTIMATE FLY LOADED",
    Text = "made by gay228\nPress button to fly, use joystick to move!",
    Duration = 5,
    Icon = "rbxassetid://4483345998"
})

print("ðŸŽ® Ultimate Fly Script by gay228 loaded!")
print("ðŸ›¸ Click button to toggle flight â€¢ Use joystick to move")
