-- The Forge: ULTIMATE FIX - Guaranteed Activation
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local localPlayer = Players.LocalPlayer

-- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ GUI
local playerGui = localPlayer:WaitForChild("PlayerGui")
for _, gui in pairs(playerGui:GetChildren()) do
    if gui.Name:find("Luck") or gui.Name:find("Forge") then
        gui:Destroy()
    end
end

-- –°–æ–∑–¥–∞–µ–º –ü–†–û–°–¢–û–ô –∏ –Ω–∞–¥–µ–∂–Ω—ã–π GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltraLuckGUI"
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 200, 0, 70)
MainFrame.Position = UDim2.new(0, 10, 0, 200)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0

local LuckButton = Instance.new("TextButton")
LuckButton.Size = UDim2.new(0.9, 0, 0.7, 0)
LuckButton.Position = UDim2.new(0.05, 0, 0.15, 0)
LuckButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
LuckButton.Text = "‚ö° –í–ö–õ–Æ–ß–ò–¢–¨ –£–î–ê–ß–£"
LuckButton.TextColor3 = Color3.fromRGB(255, 255, 255)
LuckButton.TextScaled = true
LuckButton.Font = Enum.Font.GothamBold

LuckButton.Parent = MainFrame
MainFrame.Parent = ScreenGui
ScreenGui.Parent = playerGui

-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
local luckActive = false
local originalRandom = math.random
local hookedRemotes = {}
local SUCCESS_TAG = "LEGENDARY_FORCED_99999"

-- –ê–ì–†–ï–°–°–ò–í–ù–´–ô –ü–ï–†–ï–•–í–ê–¢ –í–°–ï–• REMOTE EVENT
local function aggressivelyHookRemotes()
    print("[DEBUG] –ù–∞—á–∏–Ω–∞—é –ø–µ—Ä–µ—Ö–≤–∞—Ç –≤—Å–µ—Ö RemoteEvent...")
    local hookCount = 0
    
    -- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –í–°–ï RemoteEvent –≤ –∏–≥—Ä–µ
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("RemoteEvent") then
            local originalFire = obj.FireServer
            obj.FireServer = function(self, ...)
                local args = {...}
                
                if luckActive then
                    -- –î–û–ë–ê–í–õ–Ø–ï–ú –¢–ï–ì –£–î–ê–ß–ò –ö –õ–Æ–ë–û–ú–£ –°–û–ë–´–¢–ò–Æ
                    local newArgs = {}
                    for i, v in ipairs(args) do
                        newArgs[i] = v
                    end
                    
                    -- –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à —Ç–µ–≥ –≤ –∫–æ–Ω–µ—Ü –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
                    newArgs[#newArgs + 1] = SUCCESS_TAG
                    
                    -- –ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç —Ç–∞–±–ª–∏—Ü–∞ - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º
                    if type(newArgs[1]) == "table" then
                        newArgs[1]._ultraLuck = true
                        newArgs[1]._forcedRarity = "LEGENDARY"
                        newArgs[1]._luckMultiplier = 99999
                        
                        -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–≤–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                        for key, val in pairs(newArgs[1]) do
                            local keyLower = tostring(key):lower()
                            if keyLower:find("luck") or keyLower:find("chance") or 
                               keyLower:find("success") or keyLower:find("quality") then
                                if type(val) == "number" then
                                    newArgs[1][key] = 100
                                end
                            end
                            if keyLower:find("rarity") or keyLower:find("tier") then
                                newArgs[1][key] = 5
                            end
                        end
                    end
                    
                    -- –õ–æ–≥–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
                    print("[LUCK HOOK] –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ:", obj.Name)
                    
                    return originalFire(self, unpack(newArgs))
                end
                
                return originalFire(self, ...)
            end
            
            hookedRemotes[obj] = originalFire
            hookCount = hookCount + 1
        end
    end
    
    print("[DEBUG] –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ RemoteEvent:", hookCount)
    return hookCount
end

-- –ü–ï–†–ï–•–í–ê–¢ MATH.RANDOM –ò –î–†–£–ì–ò–• –°–õ–£–ß–ê–ô–ù–´–• –§–£–ù–ö–¶–ò–ô
local function setupMathHijack()
    -- –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    local originalRandomSeed = math.randomseed
    local originalRandom = math.random
    
    -- –ü–ï–†–ï–•–í–ê–¢ MATH.RANDOM
    math.random = function(...)
        if luckActive then
            local args = {...}
            
            -- –ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            if #args == 0 then
                return 0.99 -- –í—Å–µ–≥–¥–∞ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            end
            
            -- –ï—Å–ª–∏ –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä (max)
            if #args == 1 then
                local max = args[1]
                if max <= 10 then -- –î–ª—è —Ä–µ–¥–∫–æ—Å—Ç–∏
                    return max -- –í—Å–µ–≥–¥–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å
                elseif max == 100 then -- –î–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                    return 100 -- –í—Å–µ–≥–¥–∞ 100%
                else
                    return max -- –î–ª—è –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞–µ–≤
                end
            end
            
            -- –ï—Å–ª–∏ –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (min, max)
            if #args == 2 then
                local min, max = args[1], args[2]
                if max <= 10 then -- –î–ª—è —Ä–µ–¥–∫–æ—Å—Ç–∏
                    return max -- –í—Å–µ–≥–¥–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è
                elseif max == 100 then -- –î–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
                    return 100 -- –í—Å–µ–≥–¥–∞ —É—Å–ø–µ—Ö
                else
                    return max -- –í—Å–µ–≥–¥–∞ –º–∞–∫—Å–∏–º—É–º
                end
            end
        end
        
        -- –ò–Ω–∞—á–µ –≤—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π random
        return originalRandom(...)
    end
    
    -- –ü–ï–†–ï–•–ê–í–´–í–ê–ï–ú –†–ê–ù–î–û–ú–°–ò–î
    math.randomseed = function(seed)
        if luckActive then
            -- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∏–¥ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            return originalRandomSeed(123456789)
        end
        return originalRandomSeed(seed)
    end
    
    -- –¢–∞–∫–∂–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏
    if Random then
        local originalRandomNew = Random.new
        Random.new = function()
            local rng = originalRandomNew()
            local originalNextNumber = rng.NextNumber
            
            if luckActive then
                rng.NextNumber = function(self)
                    return 0.99 -- –í—Å–µ–≥–¥–∞ –≤—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                end
            end
            
            return rng
        end
    end
end

-- –ò–ó–ú–ï–ù–ï–ù–ò–ï –ì–õ–û–ë–ê–õ–¨–ù–´–• –¢–ê–ë–õ–ò–¶ –õ–£–¢–ê
local function modifyGlobalLootTables()
    print("[DEBUG] –ò—â—É —Ç–∞–±–ª–∏—Ü—ã –ª—É—Ç–∞...")
    
    -- –ò—â–µ–º ModuleScript —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("ModuleScript") then
            pcall(function()
                local required = require(obj)
                if type(required) == "table" then
                    -- –ú–µ–Ω—è–µ–º –ª—é–±—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å —à–∞–Ω—Å–∞–º–∏
                    for key, value in pairs(required) do
                        if type(value) == "table" then
                            -- –ï—Å–ª–∏ —ç—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å —Ä–µ–¥–∫–æ—Å—Ç—è–º–∏
                            if value.Name or value.Rarity then
                                for k, v in pairs(value) do
                                    if type(v) == "number" and (k == "Chance" or k == "chance") then
                                        if luckActive then
                                            -- –û–±–Ω—É–ª—è–µ–º —à–∞–Ω—Å –æ–±—ã—á–Ω—ã—Ö, —Å—Ç–∞–≤–∏–º 100% –Ω–∞ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ
                                            if tostring(value.Name or value.Rarity):lower():find("common") then
                                                value[k] = 0
                                            elseif tostring(value.Name or value.Rarity):lower():find("legendary") then
                                                value[k] = 100
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end
                end
            end)
        end
    end
end

-- –§–£–ù–ö–¶–ò–Ø –ê–ö–¢–ò–í–ê–¶–ò–ò
local function activateLuck()
    luckActive = true
    LuckButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    LuckButton.Text = "‚úÖ –£–î–ê–ß–ê –í–ö–õ–Æ–ß–ï–ù–ê"
    
    -- –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã
    setupMathHijack()
    local hooked = aggressivelyHookRemotes()
    modifyGlobalLootTables()
    
    -- –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
    spawn(function()
        while luckActive do
            for i = 0, 1, 0.1 do
                if not luckActive then break end
                LuckButton.BackgroundTransparency = i * 0.3
                wait(0.1)
            end
            for i = 1, 0, -0.1 do
                if not luckActive then break end
                LuckButton.BackgroundTransparency = i * 0.3
                wait(0.1)
            end
        end
        LuckButton.BackgroundTransparency = 0
    end)
    
    print("======================================")
    print("üî• ULTRA LUCK –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!")
    print("üìä –ü–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: " .. hooked)
    print("üéØ –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã: –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–´")
    print("‚ùå –û–±—ã—á–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã: –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–´")
    print("======================================")
    
    -- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∏–≥—Ä–µ
    game.StarterGui:SetCore("SendNotification", {
        Title = "–£–°–ü–ï–•! –£–¥–∞—á–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞",
        Text = "–û—Ç–Ω—ã–Ω–µ —Ç–æ–ª—å–∫–æ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã!",
        Duration = 5,
        Icon = "rbxassetid://4458901886"
    })
end

-- –§–£–ù–ö–¶–ò–Ø –î–ï–ê–ö–¢–ò–í–ê–¶–ò–ò
local function deactivateLuck()
    luckActive = false
    LuckButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    LuckButton.Text = "‚ö° –í–ö–õ–Æ–ß–ò–¢–¨ –£–î–ê–ß–£"
    
    -- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    math.random = originalRandom
    
    -- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º RemoteEvent
    for remote, original in pairs(hookedRemotes) do
        remote.FireServer = original
    end
    hookedRemotes = {}
    
    print("[DEBUG] –£–¥–∞—á–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞")
end

-- –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò
LuckButton.MouseButton1Click:Connect(function()
    if not luckActive then
        activateLuck()
    else
        deactivateLuck()
    end
end)

-- –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ê–ö–¢–ò–í–ê–¶–ò–Ø –ü–†–ò –ó–ê–ü–£–°–ö–ï
spawn(function()
    wait(2)
    
    -- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç
    aggressivelyHookRemotes()
    
    print("[SYSTEM] The Forge Luck System –∑–∞–≥—Ä—É–∂–µ–Ω!")
    print("[SYSTEM] –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É '–í–ö–õ–Æ–ß–ò–¢–¨ –£–î–ê–ß–£' –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É")
    
    -- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    wait(3)
    if not luckActive then
        print("[SYSTEM] –ê–≤—Ç–æ-–∞–∫—Ç–∏–≤–∞—Ü–∏—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...")
        activateLuck()
    end
end)

-- –ú–û–ù–ò–¢–û–†–ò–ù–ì –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò
spawn(function()
    while true do
        wait(5)
        
        if luckActive then
            -- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É—Å–∏–ª–∏–≤–∞–µ–º
            aggressivelyHookRemotes()
            
            -- –õ–æ–≥–∏—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            print("[HEARTBEAT] –£–¥–∞—á–∞ –∞–∫—Ç–∏–≤–Ω–∞ | RemoteEvent –ø–µ—Ä–µ—Ö–≤–∞—á–µ–Ω–æ: " .. #hookedRemotes)
        end
    end
end)
