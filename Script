-- Camera Control v6.0 by sherikyt - FINAL WORKING VERSION
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local mouse = player:GetMouse()

-- STATE
local marks = {}
local freeCam = false
local viewMode = false
local currentMark = 0
local camYaw = 0
local camPitch = 0
local move = {W=false,A=false,S=false,D=false,Q=false,E=false}
local speed = 25

-- CREATE GUI
local gui = Instance.new("ScreenGui")
gui.Name = "CameraControlGUI"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main panel
local main = Instance.new("Frame")
main.Name = "MainPanel"
main.Size = UDim2.new(0, 250, 0, 320)
main.Position = UDim2.new(0.02, 0, 0.3, 0)
main.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
main.BorderSizePixel = 0

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 70)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(60, 40, 100)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(40, 40, 70))
})
gradient.Rotation = 45
gradient.Parent = main

Instance.new("UICorner", main).CornerRadius = UDim.new(0, 15)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
title.Text = "CAMERA CONTROL v6.0"
title.TextColor3 = Color3.white
title.Font = Enum.Font.GothamBold
title.TextSize = 18
Instance.new("UICorner", title).CornerRadius = UDim.new(0, 15, 0, 0)
title.Parent = main

-- Counter
local counter = Instance.new("TextLabel")
counter.Size = UDim2.new(1, -20, 0, 40)
counter.Position = UDim2.new(0, 10, 0.2, 0)
counter.BackgroundTransparency = 1
counter.Text = "MARKS: 0/10 | SPEED: 25"
counter.TextColor3 = Color3.fromRGB(200, 200, 255)
counter.Font = Enum.Font.Gotham
counter.TextSize = 14
counter.Parent = main

-- Button creation function
local function createButton(name, text, posY, color)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = UDim2.new(0.9, 0, 0, 50)
    button.Position = UDim2.new(0.05, 0, posY, 0)
    button.BackgroundColor3 = color
    button.Text = text
    button.TextColor3 = Color3.white
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.AutoButtonColor = false
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = button
    
    local original = color
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = original * 1.2
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = original
    end)
    
    button.MouseButton1Down:Connect(function()
        button.BackgroundColor3 = original * 0.7
    end)
    
    button.MouseButton1Up:Connect(function()
        button.BackgroundColor3 = original * 1.2
    end)
    
    return button
end

-- Create buttons
local freeBtn = createButton("FreeBtn", "FREE CAMERA", 0.35, Color3.fromRGB(70, 130, 200))
local markBtn = createButton("MarkBtn", "PLACE MARK", 0.5, Color3.fromRGB(60, 200, 100))
local viewBtn = createButton("ViewBtn", "VIEW MARKS", 0.65, Color3.fromRGB(255, 165, 50))
local clearBtn = createButton("ClearBtn", "CLEAR ALL", 0.8, Color3.fromRGB(220, 60, 60))

freeBtn.Parent = main
markBtn.Parent = main
viewBtn.Parent = main
clearBtn.Parent = main

main.Parent = gui

-- FUNCTIONS
local function updateCounter()
    counter.Text = "MARKS: " .. #marks .. "/10 | SPEED: " .. speed
end

local function createMarker(pos)
    if #marks >= 10 then 
        counter.Text = "MAX MARKS REACHED"
        return 
    end
    
    local marker = Instance.new("Part")
    marker.Name = "CameraMark_" .. (#marks + 1)
    marker.Size = Vector3.new(2, 3, 2)
    marker.Position = pos
    marker.Anchored = true
    marker.CanCollide = false
    marker.Material = EnumMaterial.Neon
    
    local hue = (#marks / 10) * 0.8
    marker.Color = Color3.fromHSV(hue, 1, 1)
    marker.Transparency = 0.3
    
    local light = Instance.new("PointLight")
    light.Color = marker.Color
    light.Brightness = 2
    light.Range = 10
    light.Parent = marker
    
    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(0, 50, 0, 50)
    billboard.AlwaysOnTop = true
    billboard.Parent = marker
    
    local num = Instance.new("TextLabel")
    num.Size = UDim2.new(1, 0, 1, 0)
    num.BackgroundTransparency = 1
    num.Text = tostring(#marks + 1)
    num.TextColor3 = Color3.white
    num.Font = Enum.Font.GothamBold
    num.TextSize = 20
    num.Parent = billboard
    
    marker.Parent = Workspace
    
    marks[#marks + 1] = {
        position = pos,
        part = marker
    }
    
    updateCounter()
end

local function clearMarks()
    for _, mark in pairs(marks) do
        if mark.part then
            mark.part:Destroy()
        end
    end
    marks = {}
    currentMark = 0
    updateCounter()
end

local function viewMark(index)
    if #marks == 0 then return end
    
    currentMark = math.clamp(index, 1, #marks)
    local mark = marks[currentMark]
    camera.CFrame = CFrame.new(mark.position + Vector3.new(0, 5, 10), mark.position)
end

local function toggleFreeCam()
    freeCam = not freeCam
    viewMode = false
    
    if freeCam then
        camera.CameraType = Enum.CameraType.Scriptable
        camYaw = 0
        camPitch = 0
        freeBtn.Text = "EXIT FREE CAM"
    else
        camera.CameraType = Enum.CameraType.Custom
        freeBtn.Text = "FREE CAMERA"
    end
    
    updateCounter()
end

local function toggleView()
    if #marks == 0 then 
        counter.Text = "NO MARKS PLACED"
        return 
    end
    
    viewMode = not viewMode
    freeCam = false
    
    if viewMode then
        camera.CameraType = Enum.CameraType.Scriptable
        currentMark = 1
        viewMark(1)
        viewBtn.Text = "EXIT VIEW MODE"
    else
        camera.CameraType = Enum.CameraType.Custom
        viewBtn.Text = "VIEW MARKS"
    end
end

-- BUTTON EVENTS
freeBtn.MouseButton1Click:Connect(toggleFreeCam)

markBtn.MouseButton1Click:Connect(function()
    if freeCam then
        createMarker(camera.CFrame.Position)
    end
end)

viewBtn.MouseButton1Click:Connect(toggleView)

clearBtn.MouseButton1Click:Connect(clearMarks)

-- KEYBOARD CONTROLS
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F then
        toggleFreeCam()
    elseif input.KeyCode == Enum.KeyCode.M and freeCam then
        createMarker(camera.CFrame.Position)
    elseif input.KeyCode == Enum.KeyCode.V then
        toggleView()
    elseif input.KeyCode == Enum.KeyCode.C then
        clearMarks()
    elseif input.KeyCode == Enum.KeyCode.LeftBracket then
        speed = math.max(10, speed - 5)
        updateCounter()
    elseif input.KeyCode == Enum.KeyCode.RightBracket then
        speed = math.min(50, speed + 5)
        updateCounter()
    end
    
    if freeCam then
        if input.KeyCode == Enum.KeyCode.W then move.W = true
        elseif input.KeyCode == Enum.KeyCode.A then move.A = true
        elseif input.KeyCode == Enum.KeyCode.S then move.S = true
        elseif input.KeyCode == Enum.KeyCode.D then move.D = true
        elseif input.KeyCode == Enum.KeyCode.Q then move.Q = true
        elseif input.KeyCode == Enum.KeyCode.E then move.E = true
        end
    elseif viewMode then
        if input.KeyCode == Enum.KeyCode.Left then
            if currentMark > 1 then
                viewMark(currentMark - 1)
            end
        elseif input.KeyCode == Enum.KeyCode.Right then
            if currentMark < #marks then
                viewMark(currentMark + 1)
            end
        end
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if freeCam then
        if input.KeyCode == Enum.KeyCode.W then move.W = false
        elseif input.KeyCode == Enum.KeyCode.A then move.A = false
        elseif input.KeyCode == Enum.KeyCode.S then move.S = false
        elseif input.KeyCode == Enum.KeyCode.D then move.D = false
        elseif input.KeyCode == Enum.KeyCode.Q then move.Q = false
        elseif input.KeyCode == Enum.KeyCode.E then move.E = false
        end
    end
end)

-- MOUSE ROTATION
local lastMousePos
UserInputService.InputChanged:Connect(function(input)
    if freeCam and input.UserInputType == Enum.UserInputType.MouseMovement then
        if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
            if not lastMousePos then
                lastMousePos = input.Position
                return
            end
            
            local delta = input.Position - lastMousePos
            camYaw = camYaw - delta.X * 0.003
            camPitch = camPitch - delta.Y * 0.003
            camPitch = math.clamp(camPitch, -1.5, 1.5)
            lastMousePos = input.Position
        else
            lastMousePos = nil
        end
    end
end)

-- MOUSE WHEEL SPEED
mouse.WheelForward:Connect(function()
    if freeCam then
        speed = math.min(50, speed + 5)
        updateCounter()
    end
end)

mouse.WheelBackward:Connect(function()
    if freeCam then
        speed = math.max(10, speed - 5)
        updateCounter()
    end
end)

-- MAIN MOVEMENT LOOP
RunService.Heartbeat:Connect(function(dt)
    if freeCam then
        local rot = CFrame.fromOrientation(camPitch, camYaw, 0)
        local moveVec = Vector3.new(0, 0, 0)
        
        if move.W then moveVec = moveVec + Vector3.new(0, 0, -1) end
        if move.S then moveVec = moveVec + Vector3.new(0, 0, 1) end
        if move.D then moveVec = moveVec + Vector3.new(1, 0, 0) end
        if move.A then moveVec = moveVec + Vector3.new(-1, 0, 0) end
        if move.E then moveVec = moveVec + Vector3.new(0, 1, 0) end
        if move.Q then moveVec = moveVec + Vector3.new(0, -1, 0) end
        
        if moveVec.Magnitude > 0 then
            moveVec = moveVec.Unit * speed * dt
            local rotatedMove = rot:VectorToWorldSpace(moveVec)
            camera.CFrame = rot + camera.CFrame.Position + rotatedMove
        else
            camera.CFrame = rot + camera.CFrame.Position
        end
        
        camera.FieldOfView = 70
        
    elseif viewMode and #marks > 0 then
        local mark = marks[currentMark]
        if mark then
            local time = tick()
            local radius = 12
            local height = 4
            
            local x = math.cos(time * 0.4) * radius
            local z = math.sin(time * 0.4) * radius
            
            local targetPos = mark.position + Vector3.new(x, height, z)
            local lookPos = mark.position + Vector3.new(0, 2, 0)
            
            camera.CFrame = camera.CFrame:Lerp(
                CFrame.new(targetPos, lookPos),
                5 * dt
            )
            
            camera.FieldOfView = 60
        end
    end
end)

-- LOAD NOTIFICATION
local notify = Instance.new("ScreenGui", player.PlayerGui)
local note = Instance.new("TextLabel", notify)
note.Size = UDim2.new(0, 250, 0, 60)
note.Position = UDim2.new(0.5, -125, 0.1, 0)
note.BackgroundColor3 = Color3.fromRGB(40, 40, 70)
note.Text = "Camera Control v6.0 loaded!\nF=Free, M=Mark, V=View, C=Clear"
note.TextColor3 = Color3.white
note.Font = Enum.Font.GothamBold
note.TextSize = 14

Instance.new("UICorner", note).CornerRadius = UDim.new(0, 10)

task.wait(3)
notify:Destroy()

print("Camera Control v6.0 loaded!")
print("F - Toggle Free Camera")
print("M - Place Marker (in free cam)")
print("V - Toggle View Mode")
print("C - Clear All Markers")
print("WASD + QE - Movement")
print("Right Mouse - Rotate camera")
print("Mouse Wheel - Adjust speed")

-- INIT
updateCounter()
