-- Camera Control v4.0 by sherikyt
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local mouse = player:GetMouse()

-- State
local marks = {}
local freeCam = false
local viewMode = false
local currentMark = 0
local camYaw = 0
local camPitch = 0
local move = {W=false,A=false,S=false,D=false,Q=false,E=false}
local speed = 25

-- Create GUI
local gui = Instance.new("ScreenGui")
gui.Name = "CameraControl"
gui.Parent = player:WaitForChild("PlayerGui")
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main container
local main = Instance.new("Frame")
main.Name = "Main"
main.Size = UDim2.new(0, 250, 0, 300)
main.Position = UDim2.new(0.02, 0, 0.3, 0)
main.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
main.BorderSizePixel = 0

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 70)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(60, 40, 100)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(40, 40, 70))
})
gradient.Rotation = 45
gradient.Parent = main

Instance.new("UICorner", main).CornerRadius = UDim.new(0, 15)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
title.Text = "CAMERA CONTROL v4.0"
title.TextColor3 = Color3.white
title.Font = Enum.Font.GothamBold
title.TextSize = 18
Instance.new("UICorner", title).CornerRadius = UDim.new(0, 15, 0, 0)
title.Parent = main

-- Counter
local counter = Instance.new("TextLabel")
counter.Size = UDim2.new(1, -20, 0, 40)
counter.Position = UDim2.new(0, 10, 0.2, 0)
counter.BackgroundTransparency = 1
counter.Text = "MARKS: 0/10"
counter.TextColor3 = Color3.fromRGB(200, 200, 255)
counter.Font = Enum.Font.Gotham
counter.TextSize = 14
counter.Parent = main

-- Create button function
local function createButton(name, text, posY, color)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = UDim2.new(0.9, 0, 0, 45)
    button.Position = UDim2.new(0.05, 0, posY, 0)
    button.BackgroundColor3 = color
    button.Text = text
    button.TextColor3 = Color3.white
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.AutoButtonColor = false
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = button
    
    -- Button effects
    local original = color
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = original * 1.2
    end)
    
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = original
    end)
    
    button.MouseButton1Down:Connect(function()
        button.BackgroundColor3 = original * 0.7
    end)
    
    button.MouseButton1Up:Connect(function()
        button.BackgroundColor3 = original
    end)
    
    return button
end

-- Create buttons
local freeBtn = createButton("FreeBtn", "FREE CAMERA", 0.35, Color3.fromRGB(70, 130, 200))
local markBtn = createButton("MarkBtn", "PLACE MARK", 0.55, Color3.fromRGB(60, 200, 100))
local viewBtn = createButton("ViewBtn", "VIEW MARKS", 0.75, Color3.fromRGB(255, 165, 50))
local clearBtn = createButton("ClearBtn", "CLEAR ALL", 0.95, Color3.fromRGB(220, 60, 60))

freeBtn.Parent = main
markBtn.Parent = main
viewBtn.Parent = main
clearBtn.Parent = main

main.Parent = gui

-- Control panel for active modes
local control = Instance.new("Frame")
control.Name = "ControlPanel"
control.Size = UDim2.new(0, 250, 0, 180)
control.Position = UDim2.new(0.02, 0, 0.7, 0)
control.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
control.BorderSizePixel = 0
control.Visible = false

local controlGradient = Instance.new("UIGradient")
controlGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 70)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(65, 45, 100))
})
controlGradient.Rotation = 45
controlGradient.Parent = control

Instance.new("UICorner", control).CornerRadius = UDim.new(0, 15)

local controlTitle = Instance.new("TextLabel")
controlTitle.Size = UDim2.new(1, 0, 0, 40)
controlTitle.BackgroundColor3 = Color3.fromRGB(40, 40, 70)
controlTitle.Text = "ACTIVE MODE"
controlTitle.TextColor3 = Color3.white
controlTitle.Font = Enum.Font.GothamBold
controlTitle.TextSize = 16
controlTitle.Parent = control

local modeInfo = Instance.new("TextLabel")
modeInfo.Size = UDim2.new(1, -20, 0, 60)
modeInfo.Position = UDim2.new(0, 10, 0.3, 0)
modeInfo.BackgroundTransparency = 1
modeInfo.Text = "WASD = Move\nQE = Up/Down\nRMB = Rotate"
modeInfo.TextColor3 = Color3.fromRGB(200, 200, 255)
modeInfo.Font = Enum.Font.Gotham
modeInfo.TextSize = 13
modeInfo.Parent = control

local exitBtn = Instance.new("TextButton")
exitBtn.Size = UDim2.new(0.8, 0, 0, 35)
exitBtn.Position = UDim2.new(0.1, 0, 0.75, 0)
exitBtn.BackgroundColor3 = Color3.fromRGB(220, 60, 60)
exitBtn.Text = "EXIT MODE"
exitBtn.TextColor3 = Color3.white
exitBtn.Font = Enum.Font.GothamBold
exitBtn.TextSize = 14
exitBtn.AutoButtonColor = false

local exitCorner = Instance.new("UICorner")
exitCorner.CornerRadius = UDim.new(0, 10)
exitCorner.Parent = exitBtn
exitBtn.Parent = control

control.Parent = gui

-- Navigation panel
local nav = Instance.new("Frame")
nav.Size = UDim2.new(0, 250, 0, 50)
nav.Position = UDim2.new(0.02, 0, 0.9, 0)
nav.BackgroundColor3 = Color3.fromRGB(30, 30, 50)
nav.BorderSizePixel = 0
nav.Visible = false

local navGradient = Instance.new("UIGradient")
navGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 70)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(65, 45, 100))
})
navGradient.Rotation = 45
navGradient.Parent = nav

Instance.new("UICorner", nav).CornerRadius = UDim.new(0, 15)
nav.Parent = gui

local prevBtn = Instance.new("TextButton")
prevBtn.Size = UDim2.new(0.4, 0, 0.7, 0)
prevBtn.Position = UDim2.new(0.05, 0, 0.15, 0)
prevBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
prevBtn.Text = "PREV"
prevBtn.TextColor3 = Color3.white
prevBtn.Font = Enum.Font.GothamBold
prevBtn.TextSize = 12
prevBtn.Visible = false
prevBtn.AutoButtonColor = false
prevBtn.Parent = nav

local nextBtn = Instance.new("TextButton")
nextBtn.Size = UDim2.new(0.4, 0, 0.7, 0)
nextBtn.Position = UDim2.new(0.55, 0, 0.15, 0)
nextBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
nextBtn.Text = "NEXT"
nextBtn.TextColor3 = Color3.white
nextBtn.Font = Enum.Font.GothamBold
nextBtn.TextSize = 12
nextBtn.Visible = false
nextBtn.AutoButtonColor = false
nextBtn.Parent = nav

-- Core functions
local function updateCounter()
    counter.Text = "MARKS: " .. #marks .. "/10 | SPEED: " .. speed
end

local function createMarker(pos)
    if #marks >= 10 then 
        counter.Text = "MAX MARKS REACHED"
        return 
    end
    
    local marker = Instance.new("Part")
    marker.Name = "CameraMark_" .. (#marks + 1)
    marker.Size = Vector3.new(2, 3, 2)
    marker.Position = pos
    marker.Anchored = true
    marker.CanCollide = false
    marker.Material = EnumMaterial.Neon
    
    -- Color based on index
    local hue = (#marks / 10) * 0.8
    marker.Color = Color3.fromHSV(hue, 1, 1)
    marker.Transparency = 0.3
    
    -- Light
    local light = Instance.new("PointLight")
    light.Color = marker.Color
    light.Brightness = 2
    light.Range = 10
    light.Parent = marker
    
    -- Number
    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(0, 50, 0, 50)
    billboard.AlwaysOnTop = true
    billboard.Parent = marker
    
    local num = Instance.new("TextLabel")
    num.Size = UDim2.new(1, 0, 1, 0)
    num.BackgroundTransparency = 1
    num.Text = tostring(#marks + 1)
    num.TextColor3 = Color3.white
    num.Font = Enum.Font.GothamBold
    num.TextSize = 20
    num.Parent = billboard
    
    marker.Parent = Workspace
    
    marks[#marks + 1] = {
        position = pos,
        part = marker
    }
    
    updateCounter()
end

local function clearMarks()
    for _, mark in pairs(marks) do
        if mark.part then
            mark.part:Destroy()
        end
    end
    marks = {}
    currentMark = 0
    updateCounter()
end

local function viewMark(index)
    if #marks == 0 then return end
    
    currentMark = math.clamp(index, 1, #marks)
    local mark = marks[currentMark]
    
    camera.CFrame = CFrame.new(mark.position + Vector3.new(0, 5, 10), mark.position)
end

local function toggleFreeCam()
    if freeCam then
        -- Exit free cam
        freeCam = false
        camera.CameraType = Enum.CameraType.Custom
        main.Visible = true
        control.Visible = false
        nav.Visible = false
        freeBtn.Text = "FREE CAMERA"
    else
        -- Enter free cam
        freeCam = true
        viewMode = false
        camera.CameraType = Enum.CameraType.Scriptable
        camYaw = 0
        camPitch = 0
        
        main.Visible = false
        control.Visible = true
        nav.Visible = false
        
        controlTitle.Text = "FREE CAMERA MODE"
        modeInfo.Text = "WASD = Move\nQE = Up/Down\nRMB = Rotate\nM = Place Mark"
        freeBtn.Text = "EXIT FREE CAM"
    end
    
    updateCounter()
end

local function toggleView()
    if #marks == 0 then 
        counter.Text = "NO MARKS PLACED"
        return 
    end
    
    if viewMode then
        -- Exit view mode
        viewMode = false
        camera.CameraType = Enum.CameraType.Custom
        main.Visible = true
        control.Visible = false
        nav.Visible = false
        viewBtn.Text = "VIEW MARKS"
    else
        -- Enter view mode
        viewMode = true
        freeCam = false
        camera.CameraType = Enum.CameraType.Scriptable
        currentMark = 1
        
        main.Visible = false
        control.Visible = true
        nav.Visible = true
        
        controlTitle.Text = "VIEWING MARKS"
        modeInfo.Text = "MARK 1/" .. #marks .. "\nUse arrows to navigate"
        viewBtn.Text = "EXIT VIEW MODE"
        
        prevBtn.Visible = false
        nextBtn.Visible = (#marks > 1)
        
        viewMark(1)
    end
end

-- Button events
freeBtn.MouseButton1Click:Connect(toggleFreeCam)

markBtn.MouseButton1Click:Connect(function()
    if freeCam then
        createMarker(camera.CFrame.Position)
    end
end)

viewBtn.MouseButton1Click:Connect(toggleView)

clearBtn.MouseButton1Click:Connect(clearMarks)

exitBtn.MouseButton1Click:Connect(function()
    if freeCam then
        toggleFreeCam()
    elseif viewMode then
        toggleView()
    end
end)

prevBtn.MouseButton1Click:Connect(function()
    if currentMark > 1 then
        currentMark = currentMark - 1
        viewMark(currentMark)
        modeInfo.Text = "MARK " .. currentMark .. "/" .. #marks .. "\nUse arrows to navigate"
        prevBtn.Visible = (currentMark > 1)
        nextBtn.Visible = true
    end
end)

nextBtn.MouseButton1Click:Connect(function()
    if currentMark < #marks then
        currentMark = currentMark + 1
        viewMark(currentMark)
        modeInfo.Text = "MARK " .. currentMark .. "/" .. #marks .. "\nUse arrows to navigate"
        nextBtn.Visible = (currentMark < #marks)
        prevBtn.Visible = true
    end
end)

-- Keyboard controls
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F then
        toggleFreeCam()
    elseif input.KeyCode == Enum.KeyCode.M and freeCam then
        createMarker(camera.CFrame.Position)
    elseif input.KeyCode == Enum.KeyCode.V then
        toggleView()
    elseif input.KeyCode == Enum.KeyCode.C then
        clearMarks()
    elseif input.KeyCode == Enum.KeyCode.LeftBracket then
        speed = math.max(10, speed - 5)
        updateCounter()
    elseif input.KeyCode == Enum.KeyCode.RightBracket then
        speed = math.min(50, speed + 5)
        updateCounter()
    end
    
    if freeCam then
        if input.KeyCode == Enum.KeyCode.W then move.W = true
        elseif input.KeyCode == Enum.KeyCode.A then move.A = true
        elseif input.KeyCode == Enum.KeyCode.S then move.S = true
        elseif input.KeyCode == Enum.KeyCode.D then move.D = true
        elseif input.KeyCode == Enum.KeyCode.Q then move.Q = true
        elseif input.KeyCode == Enum.KeyCode.E then move.E = true
        end
    elseif viewMode then
        if input.KeyCode == Enum.KeyCode.Left then
            if currentMark > 1 then
                currentMark = currentMark - 1
                viewMark(currentMark)
                modeInfo.Text = "MARK " .. currentMark .. "/" .. #marks .. "\nUse arrows to navigate"
                prevBtn.Visible = (currentMark > 1)
                nextBtn.Visible = true
            end
        elseif input.KeyCode == Enum.KeyCode.Right then
            if currentMark < #marks then
                currentMark = currentMark + 1
                viewMark(currentMark)
                modeInfo.Text = "MARK " .. currentMark .. "/" .. #marks .. "\nUse arrows to navigate"
                nextBtn.Visible = (currentMark < #marks)
                prevBtn.Visible = true
            end
        end
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if freeCam then
        if input.KeyCode == Enum.KeyCode.W then move.W = false
        elseif input.KeyCode == Enum.KeyCode.A then move.A = false
        elseif input.KeyCode == Enum.KeyCode.S then move.S = false
        elseif input.KeyCode == Enum.KeyCode.D then move.D = false
        elseif input.KeyCode == Enum.KeyCode.Q then move.Q = false
        elseif input.KeyCode == Enum.KeyCode.E then move.E = false
        end
    end
end)

-- Mouse rotation
local lastMousePos
UserInputService.InputChanged:Connect(function(input)
    if freeCam and input.UserInputType == Enum.UserInputType.MouseMovement then
        if UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
            if not lastMousePos then
                lastMousePos = input.Position
                return
            end
            
            local delta = input.Position - lastMousePos
            camYaw = camYaw - delta.X * 0.003
            camPitch = camPitch - delta.Y * 0.003
            camPitch = math.clamp(camPitch, -1.5, 1.5)
            lastMousePos = input.Position
        else
            lastMousePos = nil
        end
    end
end)

-- Mouse wheel speed
mouse.WheelForward:Connect(function()
    if freeCam then
        speed = math.min(50, speed + 5)
        updateCounter()
    end
end)

mouse.WheelBackward:Connect(function()
    if freeCam then
        speed = math.max(10, speed - 5)
        updateCounter()
    end
end)

-- Main movement loop
RunService.Heartbeat:Connect(function(dt)
    if freeCam then
        -- Create rotation
        local rot = CFrame.fromOrientation(camPitch, camYaw, 0)
        
        -- Calculate movement
        local moveVec = Vector3.new(0, 0, 0)
        if move.W then moveVec = moveVec + Vector3.new(0, 0, -1) end
        if move.S then moveVec = moveVec + Vector3.new(0, 0, 1) end
        if move.D then moveVec = moveVec + Vector3.new(1, 0, 0) end
        if move.A then moveVec = moveVec + Vector3.new(-1, 0, 0) end
        if move.E then moveVec = moveVec + Vector3.new(0, 1, 0) end
        if move.Q then moveVec = moveVec + Vector3.new(0, -1, 0) end
        
        -- Apply movement
        if moveVec.Magnitude > 0 then
            moveVec = moveVec.Unit * speed * dt
            local rotatedMove = rot:VectorToWorldSpace(moveVec)
            camera.CFrame = rot + camera.CFrame.Position + rotatedMove
        else
            camera.CFrame = rot + camera.CFrame.Position
        end
        
        camera.FieldOfView = 70
        
    elseif viewMode and #marks > 0 then
        -- Smooth orbiting around marker
        local mark = marks[currentMark]
        if mark then
            local time = tick()
            local radius = 12
            local height = 4
            
            local x = math.cos(time * 0.4) * radius
            local z = math.sin(time * 0.4) * radius
            
            local targetPos = mark.position + Vector3.new(x, height, z)
            local lookPos = mark.position + Vector3.new(0, 2, 0)
            
            camera.CFrame = camera.CFrame:Lerp(
                CFrame.new(targetPos, lookPos),
                5 * dt
            )
            
            camera.FieldOfView = 60
        end
    end
end)

-- Notification
local notify = Instance.new("ScreenGui", player.PlayerGui)
local note = Instance.new("TextLabel", notify)
note.Size = UDim2.new(0, 250, 0, 60)
note.Position = UDim2.new(0.5, -125, 0.1, 0)
note.BackgroundColor3 = Color3.fromRGB(40, 40, 70)
note.Text = "Camera Control v4.0 loaded!\nF=Free, M=Mark, V=View, C=Clear"
note.TextColor3 = Color3.white
note.Font = Enum.Font.GothamBold
note.TextSize = 14

Instance.new("UICorner", note).CornerRadius = UDim.new(0, 10)

task.wait(3)
notify:Destroy()

print("Camera Control v4.0 by sherikyt - Ready!")

-- Initialize
updateCounter()
