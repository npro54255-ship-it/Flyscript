-- Ultimate Mobile System v2.0 by sherikyt
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Enhanced Config
local config = {
    maxMarkers = 10,
    flySpeed = 50,
    cameraFOV = 80,
    minSpeed = 1,
    maxSpeed = 500,
    dashPower = 150,
    speedBoostPower = 5,
    jumpPower = 200,
    invisDuration = 15,
    noclipEnabled = false,
    espEnabled = false,
    aimbotEnabled = false
}

-- Premium Colors
local flyColors = {
    bg = Color3.fromRGB(15, 15, 25),
    primary = Color3.fromRGB(138, 43, 226),
    secondary = Color3.fromRGB(186, 85, 211),
    light = Color3.fromRGB(240, 240, 255),
    blue = Color3.fromRGB(0, 180, 255),
    green = Color3.fromRGB(0, 230, 120),
    red = Color3.fromRGB(255, 50, 50),
    yellow = Color3.fromRGB(255, 215, 0)
}

local trollColors = {
    bg = Color3.fromRGB(20, 0, 10),
    primary = Color3.fromRGB(255, 20, 20),
    secondary = Color3.fromRGB(255, 0, 100),
    light = Color3.fromRGB(255, 180, 180),
    dark = Color3.fromRGB(10, 0, 5),
    purple = Color3.fromRGB(180, 0, 255),
    orange = Color3.fromRGB(255, 100, 0)
}

-- Advanced State
local state = {
    mode = "fly",
    markers = {},
    flying = false,
    viewing = false,
    flyPos = Vector3.new(0, 0, 0),
    flyAng = Vector2.new(0, 0),
    viewAng = Vector2.new(0, 0),
    zoom = 1,
    speed = 50,
    markerIndex = 0,
    isSpeedBoost = false,
    isInvisible = false,
    isHighJump = false,
    noclip = false,
    esp = false,
    aimbot = false,
    xray = false,
    flyNoClip = true,
    infJump = false,
    antiAfk = false,
    autoFarm = false,
    clickTp = false,
    reach = false,
    flyBoost = false,
    godMode = false
}

-- Store original values
local original = {
    jumpPower = 50,
    walkSpeed = 16,
    gravity = 196.2,
    brightness = 1,
    fogEnd = 100000
}

-- Create Main GUI
local gui = Instance.new("ScreenGui")
gui.Name = "UltimateSystemPro"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- Main Container with shadow
local main = Instance.new("Frame")
main.Size = UDim2.new(0, 320, 0, 280)
main.Position = UDim2.new(0, 10, 0, 10)
main.BackgroundColor3 = flyColors.bg
main.BackgroundTransparency = 0.1
main.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = main

local shadow = Instance.new("ImageLabel")
shadow.Size = UDim2.new(1, 10, 1, 10)
shadow.Position = UDim2.new(0, -5, 0, -5)
shadow.BackgroundTransparency = 1
shadow.Image = "rbxassetid://1316045217"
shadow.ImageColor3 = Color3.new(0, 0, 0)
shadow.ImageTransparency = 0.8
shadow.ScaleType = Enum.ScaleType.Slice
shadow.SliceCenter = Rect.new(10, 10, 118, 118)
shadow.Parent = main

-- Title Bar with gradient
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, -20, 0, 45)
titleBar.Position = UDim2.new(0, 10, 0, 10)
titleBar.BackgroundTransparency = 1
titleBar.Parent = main

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, flyColors.primary),
    ColorSequenceKeypoint.new(1, flyColors.secondary)
})
gradient.Rotation = 90

local titleBg = Instance.new("Frame")
titleBg.Size = UDim2.new(1, 0, 1, 0)
titleBg.BackgroundColor3 = flyColors.primary
titleBg.Parent = titleBar
gradient:Clone().Parent = titleBg
Instance.new("UICorner", titleBg).CornerRadius = UDim.new(0, 8)

local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.7, 0, 1, 0)
title.BackgroundTransparency = 1
title.Text = "üöÄ ULTIMATE SYSTEM PRO"
title.TextColor3 = flyColors.light
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

local modeBtn = Instance.new("TextButton")
modeBtn.Size = UDim2.new(0, 45, 0, 45)
modeBtn.Position = UDim2.new(1, -45, 0, 0)
modeBtn.BackgroundColor3 = flyColors.secondary
modeBtn.Text = "üëø"
modeBtn.TextColor3 = flyColors.light
modeBtn.Font = Enum.Font.GothamBold
modeBtn.TextSize = 22
modeBtn.Parent = titleBar
Instance.new("UICorner", modeBtn).CornerRadius = UDim.new(0, 8)

-- Status Panel
local status = Instance.new("Frame")
status.Size = UDim2.new(1, -20, 0, 70)
status.Position = UDim2.new(0, 10, 0, 65)
status.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
status.BackgroundTransparency = 0.3
status.Parent = main
Instance.new("UICorner", status).CornerRadius = UDim.new(0, 10)

local statusText = Instance.new("TextLabel")
statusText.Size = UDim2.new(1, -10, 1, -10)
statusText.Position = UDim2.new(0, 5, 0, 5)
statusText.BackgroundTransparency = 1
statusText.Text = "Markers: 0/10\nStatus: Ready\nFPS: 60"
statusText.TextColor3 = flyColors.light
statusText.Font = Enum.Font.Gotham
statusText.TextSize = 12
statusText.TextWrapped = true
statusText.TextXAlignment = Enum.TextXAlignment.Left
statusText.Parent = status

-- FPS Counter
local lastTime = tick()
local frameCount = 0
local fps = 60

local function updateFPS()
    frameCount = frameCount + 1
    local currentTime = tick()
    if currentTime - lastTime >= 1 then
        fps = math.floor(frameCount / (currentTime - lastTime))
        frameCount = 0
        lastTime = currentTime
    end
end

-- Button creator with hover effects
local function createBtn(name, text, pos, size, color, isTroll)
    local colors = isTroll and trollColors or flyColors
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = size
    btn.Position = pos
    btn.BackgroundColor3 = color or colors.primary
    btn.Text = text
    btn.TextColor3 = colors.light
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 12
    btn.AutoButtonColor = false
    btn.Parent = main
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn
    
    local hover = Instance.new("Frame")
    hover.Size = UDim2.new(1, 0, 1, 0)
    hover.BackgroundColor3 = Color3.new(1, 1, 1)
    hover.BackgroundTransparency = 0.9
    hover.Visible = false
    hover.Parent = btn
    Instance.new("UICorner", hover).CornerRadius = UDim.new(0, 8)
    
    btn.MouseEnter:Connect(function()
        hover.Visible = true
        btn.BackgroundColor3 = btn.BackgroundColor3:Lerp(Color3.new(1, 1, 1), 0.2)
    end)
    
    btn.MouseLeave:Connect(function()
        hover.Visible = false
        btn.BackgroundColor3 = color or colors.primary
    end)
    
    return btn
end

-- Create fly mode buttons
local function createFlyButtons()
    local buttons = {}
    
    -- Row 1
    buttons.flyBtn = createBtn("FlyBtn", "üöÄ FLY MODE", UDim2.new(0, 10, 0, 145), UDim2.new(0.48, 0, 0, 30), flyColors.primary)
    buttons.markBtn = createBtn("MarkBtn", "üìç ADD MARKER", UDim2.new(0.52, 0, 0, 145), UDim2.new(0.48, 0, 0, 30), flyColors.secondary)
    
    -- Row 2
    buttons.viewBtn = createBtn("ViewBtn", "üëÅÔ∏è VIEW MARKS", UDim2.new(0, 10, 0, 180), UDim2.new(0.48, 0, 0, 30), flyColors.blue)
    buttons.tpBtn = createBtn("TpBtn", "‚ö° TELEPORT", UDim2.new(0.52, 0, 0, 180), UDim2.new(0.48, 0, 0, 30), flyColors.green)
    
    -- Row 3
    buttons.clearBtn = createBtn("ClearBtn", "üóëÔ∏è CLEAR ALL", UDim2.new(0, 10, 0, 215), UDim2.new(0.48, 0, 0, 30), flyColors.red)
    buttons.settingsBtn = createBtn("SettingsBtn", "‚öôÔ∏è SETTINGS", UDim2.new(0.52, 0, 0, 215), UDim2.new(0.48, 0, 0, 30), flyColors.yellow)
    
    -- Row 4
    buttons.noclipBtn = createBtn("NoclipBtn", "üëª NO CLIP", UDim2.new(0, 10, 0, 250), UDim2.new(0.48, 0, 0, 30), Color3.fromRGB(100, 100, 255))
    buttons.infJumpBtn = createBtn("InfJumpBtn", "ü¶ò INF JUMP", UDim2.new(0.52, 0, 0, 250), UDim2.new(0.48, 0, 0, 30), Color3.fromRGB(0, 200, 100))
    
    return buttons
end

-- Create troll mode buttons (5x2 grid for 10 functions)
local function createTrollButtons()
    local buttons = {}
    local btnColors = {
        trollColors.primary,
        trollColors.secondary,
        Color3.fromRGB(255, 50, 100),
        Color3.fromRGB(180, 0, 255),
        Color3.fromRGB(255, 100, 0),
        Color3.fromRGB(0, 200, 200),
        Color3.fromRGB(200, 200, 0),
        Color3.fromRGB(100, 255, 100),
        Color3.fromRGB(255, 0, 200),
        Color3.fromRGB(0, 100, 255)
    }
    
    for i = 1, 10 do
        local row = math.floor((i-1)/2)
        local col = (i-1)%2
        local x = 10 + col * 155
        local y = 145 + row * 35
        
        buttons["trollBtn"..i] = createBtn(
            "TrollBtn"..i,
            "LOADING...",
            UDim2.new(0, x, 0, y),
            UDim2.new(0, 150, 0, 30),
            btnColors[i],
            true
        )
        buttons["trollBtn"..i].Visible = false
    end
    
    return buttons
end
-- Create buttons
local flyButtons = createFlyButtons()
local trollButtons = createTrollButtons()

-- Exit button (floating)
local exitBtn = Instance.new("TextButton")
exitBtn.Name = "ExitBtn"
exitBtn.Size = UDim2.new(0, 80, 0, 35)
exitBtn.Position = UDim2.new(0.5, -40, 0, 10)
exitBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
exitBtn.Text = "‚úñ EXIT"
exitBtn.TextColor3 = Color3.new(1, 1, 1)
exitBtn.Font = Enum.Font.GothamBold
exitBtn.TextSize = 14
exitBtn.Visible = false
exitBtn.Parent = gui
Instance.new("UICorner", exitBtn).CornerRadius = UDim.new(0, 8)

-- Fly Controls Panel
local flyPanel = Instance.new("Frame")
flyPanel.Size = UDim2.new(1, 0, 0, 220)
flyPanel.Position = UDim2.new(0, 0, 1, -220)
flyPanel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
flyPanel.BackgroundTransparency = 0.7
flyPanel.Visible = false
flyPanel.Parent = gui

-- Advanced control grid
local function createControlBtn(text, pos, size)
    local btn = Instance.new("TextButton")
    btn.Size = size
    btn.Position = pos
    btn.BackgroundColor3 = flyColors.primary
    btn.BackgroundTransparency = 0.3
    btn.Text = text
    btn.TextColor3 = flyColors.light
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.AutoButtonColor = false
    btn.Parent = flyPanel
    
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0.3, 0)
    
    local hover = Instance.new("Frame")
    hover.Size = UDim2.new(1, 0, 1, 0)
    hover.BackgroundColor3 = Color3.new(1, 1, 1)
    hover.BackgroundTransparency = 0.8
    hover.Visible = false
    hover.Parent = btn
    
    btn.MouseEnter:Connect(function() hover.Visible = true end)
    btn.MouseLeave:Connect(function() hover.Visible = false end)
    
    return btn
end

-- Movement controls
local moveForward = createControlBtn("‚¨Ü", UDim2.new(0.5, -25, 0.15, -25), UDim2.new(0, 50, 0, 50))
local moveBack = createControlBtn("‚¨á", UDim2.new(0.5, -25, 0.85, -25), UDim2.new(0, 50, 0, 50))
local moveLeft = createControlBtn("‚¨Ö", UDim2.new(0.2, -25, 0.5, -25), UDim2.new(0, 50, 0, 50))
local moveRight = createControlBtn("‚û°", UDim2.new(0.8, -25, 0.5, -25), UDim2.new(0, 50, 0, 50))
local moveUp = createControlBtn("‚Üë", UDim2.new(0.2, -25, 0.15, -25), UDim2.new(0, 50, 0, 50))
local moveDown = createControlBtn("‚Üì", UDim2.new(0.8, -25, 0.15, -25), UDim2.new(0, 50, 0, 50))
local lookLeft = createControlBtn("‚óÄ", UDim2.new(0.2, -25, 0.85, -25), UDim2.new(0, 50, 0, 50))
local lookRight = createControlBtn("‚ñ∂", UDim2.new(0.8, -25, 0.85, -25), UDim2.new(0, 50, 0, 50))

-- Speed control panel
local speedPanel = Instance.new("Frame")
speedPanel.Size = UDim2.new(0.6, 0, 0, 45)
speedPanel.Position = UDim2.new(0.2, 0, 0, 10)
speedPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
speedPanel.BackgroundTransparency = 0.5
speedPanel.Visible = false
speedPanel.Parent = gui
Instance.new("UICorner", speedPanel).CornerRadius = UDim.new(0, 10)

local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(0.4, 0, 1, 0)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "SPEED: 50"
speedLabel.TextColor3 = flyColors.light
speedLabel.Font = Enum.Font.GothamBold
speedLabel.TextSize = 14
speedLabel.Parent = speedPanel

local speedDown = createControlBtn("‚ûñ", UDim2.new(0.4, 0, 0, 5), UDim2.new(0, 35, 0, 35))
speedDown.Parent = speedPanel
local speedUp = createControlBtn("‚ûï", UDim2.new(0.85, 0, 0, 5), UDim2.new(0, 35, 0, 35))
speedUp.Parent = speedPanel

-- Advanced fly actions
local flyActions = Instance.new("Frame")
flyActions.Size = UDim2.new(0, 300, 0, 50)
flyActions.Position = UDim2.new(0.5, -150, 0.5, 50)
flyActions.BackgroundTransparency = 1
flyActions.Visible = false
flyActions.Parent = gui

local teleportBtn = createControlBtn("‚ö° TP TO CAM", UDim2.new(0, 0, 0, 0), UDim2.new(0.48, 0, 1, 0))
teleportBtn.Parent = flyActions
local flyMarkBtn = createControlBtn("üìç MARK POS", UDim2.new(0.52, 0, 0, 0), UDim2.new(0.48, 0, 1, 0))
flyMarkBtn.Parent = flyActions

-- View Controls
local viewPanel = Instance.new("Frame")
viewPanel.Size = UDim2.new(1, 0, 0, 100)
viewPanel.Position = UDim2.new(0, 0, 1, -100)
viewPanel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
viewPanel.BackgroundTransparency = 0.6
viewPanel.Visible = false
viewPanel.Parent = gui

local prevBtn = createControlBtn("‚óÄ PREV", UDim2.new(0.1, 0, 0.2, 0), UDim2.new(0.2, 0, 0.6, 0))
prevBtn.Parent = viewPanel
local nextBtn = createControlBtn("NEXT ‚ñ∂", UDim2.new(0.7, 0, 0.2, 0), UDim2.new(0.2, 0, 0.6, 0))
nextBtn.Parent = viewPanel

local zoomLabel = Instance.new("TextLabel")
zoomLabel.Size = UDim2.new(0.4, 0, 0.6, 0)
zoomLabel.Position = UDim2.new(0.3, 0, 0.2, 0)
zoomLabel.BackgroundTransparency = 1
zoomLabel.Text = "ZOOM: 1.0x"
zoomLabel.TextColor3 = flyColors.light
zoomLabel.Font = Enum.Font.GothamBold
zoomLabel.TextSize = 14
zoomLabel.Parent = viewPanel

-- Advanced transition effects
local transitionOverlay = Instance.new("Frame")
transitionOverlay.Size = UDim2.new(1, 0, 1, 0)
transitionOverlay.BackgroundColor3 = Color3.new(0, 0, 0)
transitionOverlay.BackgroundTransparency = 1
transitionOverlay.ZIndex = 100
transitionOverlay.Parent = gui

local modeText = Instance.new("TextLabel")
modeText.Size = UDim2.new(0, 400, 0, 100)
modeText.Position = UDim2.new(0.5, -200, 0.5, -50)
modeText.BackgroundTransparency = 1
modeText.Text = ""
modeText.TextColor3 = Color3.new(1, 1, 1)
modeText.Font = Enum.Font.GothamBold
modeText.TextSize = 48
modeText.TextStrokeTransparency = 0.5
modeText.Visible = false
modeText.ZIndex = 101
modeText.Parent = gui

-- Enhanced marker system
local markerFolder = Instance.new("Folder")
markerFolder.Name = "UltimateMarkers"
markerFolder.Parent = Workspace

local function createMarker(pos, index)
    local marker = Instance.new("Part")
    marker.Name = "Marker_" .. index
    marker.Size = Vector3.new(2.5, 2.5, 2.5)
    marker.Position = pos
    marker.Anchored = true
    marker.CanCollide = false
    marker.Transparency = 0.2
    marker.Material = EnumMaterial.Neon
    marker.Color = flyColors.primary
    marker.Parent = markerFolder
    
    local glow = Instance.new("SurfaceLight")
    glow.Color = flyColors.secondary
    glow.Brightness = 2
    glow.Range = 12
    glow.Face = Enum.NormalId.Top
    glow.Parent = marker
    
    local pointLight = Instance.new("PointLight")
    pointLight.Color = flyColors.secondary
    pointLight.Brightness = 5
    pointLight.Range = 15
    pointLight.Parent = marker
    
    local billboard = Instance.new("BillboardGui")
    billboard.Size = UDim2.new(0, 100, 0, 40)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = marker
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = "üìç MARK " .. index
    label.TextColor3 = flyColors.light
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextStrokeTransparency = 0
    label.Parent = billboard
    
    return marker
end

-- Mode management
local function playModeTransition(newMode)
    local isTroll = newMode == "troll"
    local text = isTroll and "üòà TROLL MODE" or "üöÄ FLY MODE"
    local color = isTroll and Color3.fromRGB(255, 0, 50) or Color3.fromRGB(0, 150, 255)
    
    modeText.Text = text
    modeText.TextColor3 = color
    modeText.Visible = true
    
    local fadeIn = TweenService:Create(transitionOverlay, TweenInfo.new(0.3), {BackgroundTransparency = 0.7})
    local textIn = TweenService:Create(modeText, TweenInfo.new(0.3), {TextTransparency = 0})
    
    local fadeOut = TweenService:Create(transitionOverlay, TweenInfo.new(0.5), {BackgroundTransparency = 1})
    local textOut = TweenService:Create(modeText, TweenInfo.new(0.5), {TextTransparency = 1})
    
    fadeIn:Play()
    textIn:Play()
    wait(0.8)
    textOut:Play()
    wait(0.5)
    fadeOut:Play()
    wait(0.3)
    
    modeText.Visible = false
end

local function updateUI()
    local isTroll = state.mode == "troll"
    local colors = isTroll and trollColors or flyColors
    
    -- Update colors
    main.BackgroundColor3 = colors.bg
    titleBg.BackgroundColor3 = colors.primary
    
    if isTroll then
        local trollGradient = Instance.new("UIGradient")
        trollGradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, trollColors.primary),
            ColorSequenceKeypoint.new(1, trollColors.secondary)
        })
        trollGradient.Rotation = 90
        trollGradient.Parent = titleBg
    end
    
    title.Text = isTroll and "üòà TROLL MODE" or "üöÄ FLY MODE"
    title.TextColor3 = colors.light
    modeBtn.BackgroundColor3 = colors.secondary
    modeBtn.Text = isTroll and "‚ú®" or "üëø"
    
    -- Update status text
    updateFPS()
    local count = #state.markers
    if isTroll then
        statusText.Text = string.format("TROLL MODE ACTIVATED!\n10 Demonic Powers Ready\nFPS: %d", fps)
    else
        local statusLines = {
            string.format("Markers: %d/10", count),
            state.flying and "Status: Flying" or state.viewing and "Status: Viewing" or "Status: Ready",
            string.format("FPS: %d", fps),
            state.noclip and "NoClip: ON" or "NoClip: OFF",
            state.infJump and "InfJump: ON" or "InfJump: OFF"
        }
        statusText.Text = table.concat(statusLines, "\n")
    end
    
    -- Show/hide buttons
    for name, btn in pairs(flyButtons) do
        btn.Visible = not isTroll
    end
    
    for i = 1, 10 do
        trollButtons["trollBtn"..i].Visible = isTroll
    end
end

-- Initialize troll button texts
local trollFunctions = {
    "1. PLAYER TP",
    "2. SUPER DASH",
    "3. SPEED x5",
    "4. INVISIBLE",
    "5. HIGH JUMP",
    "6. GOD MODE",
    "7. ANTI-AFK",
    "8. ESP WALLS",
    "9. AIMBOT",
    "10. X-RAY"
}

for i, text in ipairs(trollFunctions) do
    trollButtons["trollBtn"..i].Text = text
end

-- Mode switch function
local function switchMode()
    playModeTransition(state.mode == "fly" and "troll" or "fly")
    state.mode = state.mode == "fly" and "troll" or "fly"
    updateUI()
end

-- Fly functions
local flyDir = {forward=false, back=false, left=false, right=false, up=false, down=false}
local camRot = {left=false, right=false}

local function updateFlyStatus()
    local count = #state.markers
    local text = string.format("Markers: %d/10", count)
    
    if state.flying then
        text = string.format("Flying Active\nMarkers: %d/10\nSpeed: %d\nNoClip: %s", 
            count, state.speed, state.flyNoClip and "ON" or "OFF")
    elseif state.viewing and count > 0 then
        text = string.format("Viewing %d/%d\nZoom: %.1fx", state.markerIndex or 1, count, state.zoom)
    end
    
    if state.noclip then
        text = text .. "\nNoClip: ON"
    end
    if state.infJump then
        text = text .. "\nInfJump: ON"
    end
    
    statusText.Text = text
end

local function placeMarker(pos)
    if #state.markers >= config.maxMarkers then
        statusText.Text = "Maximum 10 markers reached!"
        task.wait(1.5)
        updateFlyStatus()
        return false
    end
    
    local index = #state.markers + 1
    createMarker(pos, index)
    table.insert(state.markers, {
        position = pos,
        index = index,
        time = os.time()
    })
    
    statusText.Text = string.format("‚úÖ Marker #%d placed!", index)
    task.wait(1)
    updateFlyStatus()
    return true
end

local function clearMarkers()
    markerFolder:ClearAllChildren()
    state.markers = {}
    state.markerIndex = 0
    statusText.Text = "‚úÖ All markers cleared!"
    task.wait(1)
    updateFlyStatus()
end

local function changeSpeed(amount)
    state.speed = math.clamp(state.speed + amount, config.minSpeed, config.maxSpeed)
    speedLabel.Text = string.format("SPEED: %d", state.speed)
    updateFlyStatus()
end

local function startFlying()
    if state.flying or state.mode ~= "fly" then return end
    
    state.flying = true
    local camera = Workspace.CurrentCamera
    state.flyPos = camera.CFrame.Position
    
    local look = camera.CFrame.LookVector
    state.flyAng = Vector2.new(math.atan2(look.X, look.Z), math.asin(-look.Y))
    
    camera.CameraType = Enum.CameraType.Scriptable
    
    -- Show controls
    flyPanel.Visible = true
    speedPanel.Visible = true
    flyActions.Visible = true
    exitBtn.Visible = true
    main.Visible = false
    
    statusText.Text = "üöÄ Fly Mode Active!\nUse controls to move"
end

local function stopFlying()
    if not state.flying then return end
    
    state.flying = false
    Workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
    
    -- Hide controls
    flyPanel.Visible = false
    speedPanel.Visible = false
    flyActions.Visible = false
    exitBtn.Visible = false
    main.Visible = true
    
    updateFlyStatus()
end
-- NoClip function
local function toggleNoClip()
    state.noclip = not state.noclip
    
    if state.noclip then
        statusText.Text = "‚úÖ NoClip: ENABLED"
        
        -- Create noclip loop
        local noclipLoop = RunService.Stepped:Connect(function()
            if not state.noclip then
                noclipLoop:Disconnect()
                return
            end
            
            local character = player.Character
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
        
        -- Store connection for cleanup
        state.noclipConnection = noclipLoop
    else
        if state.noclipConnection then
            state.noclipConnection:Disconnect()
            state.noclipConnection = nil
        end
        statusText.Text = "‚ùå NoClip: DISABLED"
    end
    
    task.wait(1)
    updateUI()
end

-- Infinite Jump function
local function toggleInfiniteJump()
    state.infJump = not state.infJump
    
    if state.infJump then
        statusText.Text = "‚úÖ Infinite Jump: ENABLED"
        
        UserInputService.JumpRequest:Connect(function()
            if state.infJump then
                local character = player.Character
                if character then
                    local humanoid = character:FindFirstChild("Humanoid")
                    if humanoid then
                        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end
            end
        end)
    else
        statusText.Text = "‚ùå Infinite Jump: DISABLED"
    end
    
    task.wait(1)
    updateUI()
end

-- Enhanced teleport function
local function teleportToCamera()
    if not state.flying then return end
    
    local character = player.Character
    if character then
        local hrp = character:FindFirstChild("HumanoidRootPart")
        if hrp then
            stopFlying()
            
            -- Add teleport effect
            local effect = Instance.new("Part")
            effect.Size = Vector3.new(5, 5, 5)
            effect.Position = hrp.Position
            effect.Anchored = true
            effect.CanCollide = false
            effect.Transparency = 0.7
            effect.Color = flyColors.primary
            effect.Material = EnumMaterial.Neon
            effect.Parent = Workspace
            
            local light = Instance.new("PointLight")
            light.Color = flyColors.secondary
            light.Brightness = 10
            light.Range = 20
            light.Parent = effect
            
            -- Teleport
            hrp.CFrame = CFrame.new(state.flyPos)
            
            -- Cleanup effect
            task.wait(0.5)
            effect:Destroy()
            
            statusText.Text = "‚úÖ Teleported to camera position!"
            task.wait(1)
            updateFlyStatus()
        end
    end
end

-- Start viewing markers
local function startViewing()
    if #state.markers == 0 or state.mode ~= "fly" then
        statusText.Text = "‚ùå No markers placed!"
        task.wait(1)
        updateFlyStatus()
        return
    end
    
    state.viewing = true
    state.markerIndex = 1
    state.viewAng = Vector2.new(0, 0)
    state.zoom = 1
    
    Workspace.CurrentCamera.CameraType = Enum.CameraType.Scriptable
    
    viewPanel.Visible = true
    exitBtn.Visible = true
    main.Visible = false
    
    updateFlyStatus()
end

local function stopViewing()
    state.viewing = false
    Workspace.CurrentCamera.CameraType = Enum.CameraType.Custom
    
    viewPanel.Visible = false
    exitBtn.Visible = false
    main.Visible = true
    
    updateFlyStatus()
end

local function switchMarker(dir)
    if #state.markers == 0 then return end
    state.markerIndex = dir == "next" and 
        (state.markerIndex % #state.markers) + 1 or
        (state.markerIndex - 2) % #state.markers + 1
    zoomLabel.Text = string.format("ZOOM: %.1fx", state.zoom)
    updateFlyStatus()
end

-- ============ 10 ULTRA TROLL FUNCTIONS ============

-- 1. TELEPORT TO PLAYER (Enhanced)
local function teleportToPlayer()
    statusText.Text = "üìù Enter player name in chat..."
    
    local connection
    connection = player.Chatted:Connect(function(msg)
        if state.mode ~= "troll" then return end
        
        for _, targetPlayer in pairs(Players:GetPlayers()) do
            if string.lower(targetPlayer.Name):find(string.lower(msg)) and targetPlayer ~= player then
                local character = player.Character
                local targetCharacter = targetPlayer.Character
                
                if character and targetCharacter then
                    local hrp = character:FindFirstChild("HumanoidRootPart")
                    local targetHrp = targetCharacter:FindFirstChild("HumanoidRootPart")
                    
                    if hrp and targetHrp then
                        -- Create teleport effect
                        local effect = Instance.new("Part")
                        effect.Size = Vector3.new(3, 3, 3)
                        effect.Position = hrp.Position
                        effect.Anchored = true
                        effect.CanCollide = false
                        effect.Transparency = 0.5
                        effect.Color = Color3.fromRGB(255, 0, 0)
                        effect.Material = EnumMaterial.Neon
                        effect.Parent = Workspace
                        
                        -- Teleport
                        hrp.CFrame = targetHrp.CFrame * CFrame.new(0, 3, 0)
                        
                        -- Destroy effect
                        task.wait(0.3)
                        effect:Destroy()
                        
                        statusText.Text = string.format("‚úÖ Teleported to %s!", targetPlayer.Name)
                        task.wait(2)
                        updateUI()
                        
                        connection:Disconnect()
                        return
                    end
                end
            end
        end
    end)
    
    task.wait(10)
    if connection then
        connection:Disconnect()
    end
    statusText.Text = "Teleport: TIMEOUT"
    task.wait(1)
    updateUI()
end

-- 2. SUPER DASH (Enhanced)
local function superDash()
    local character = player.Character
    if not character then return end
    
    local hrp = character:FindFirstChild("HumanoidRootPart")
    local humanoid = character:FindFirstChild("Humanoid")
    
    if hrp and humanoid then
        local lookVector = hrp.CFrame.LookVector
        local velocity = lookVector * config.dashPower * 3 -- 3x more powerful
        
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        
        -- Create trail effect
        local trail = Instance.new("Trail")
        trail.Color = ColorSequence.new(Color3.fromRGB(255, 0, 100))
        trail.Lifetime = 0.5
        trail.Parent = hrp
        
        -- Apply velocity
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Velocity = velocity
        bodyVelocity.MaxForce = Vector3.new(10000, 10000, 10000)
        bodyVelocity.Parent = hrp
        
        -- Create explosion effect at destination
        task.wait(0.2)
        local explosion = Instance.new("Explosion")
        explosion.Position = hrp.Position
        explosion.BlastPressure = 0
        explosion.BlastRadius = 10
        explosion.Visible = false
        explosion.Parent = Workspace
        
        -- Cleanup
        game:GetService("Debris"):AddItem(bodyVelocity, 0.5)
        game:GetService("Debris"):AddItem(trail, 1)
        
        statusText.Text = "‚ö° SUPER DASH ACTIVATED!"
        task.wait(1)
        updateUI()
    end
end

-- 3. SPEED BOOST x5 (Enhanced)
local function speedBoostX5()
    if state.isSpeedBoost then return end
    
    state.isSpeedBoost = true
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        original.walkSpeed = humanoid.WalkSpeed
        humanoid.WalkSpeed = original.walkSpeed * config.speedBoostPower
        
        trollButtons.trollBtn3.Text = "üèÉ SPEED x5 ACTIVE"
        trollButtons.trollBtn3.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        
        -- Create speed lines effect
        local speedEffect = Instance.new("Part")
        speedEffect.Size = Vector3.new(20, 20, 20)
        speedEffect.Position = hrp.Position
        speedEffect.Anchored = true
        speedEffect.CanCollide = false
        speedEffect.Transparency = 1
        speedEffect.Parent = character
        
        local particleEmitter = Instance.new("ParticleEmitter")
        particleEmitter.Color = ColorSequence.new(Color3.fromRGB(255, 255, 0))
        particleEmitter.Size = NumberSequence.new(0.5)
        particleEmitter.Transparency = NumberSequence.new(0.5)
        particleEmitter.Lifetime = NumberRange.new(0.5)
        particleEmitter.Rate = 100
        particleEmitter.Speed = NumberRange.new(5)
        particleEmitter.Parent = speedEffect
        
        statusText.Text = "üèÉ SPEED BOOST x5 ACTIVE!"
        
        task.wait(10)
        
        -- Restore speed
        humanoid.WalkSpeed = original.walkSpeed
        state.isSpeedBoost = false
        speedEffect:Destroy()
        
        trollButtons.trollBtn3.Text = "3. SPEED x5"
        trollButtons.trollBtn3.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
        
        statusText.Text = "Speed boost ended"
        task.wait(1)
        updateUI()
    end
end

-- 4. INVISIBLE (Enhanced)
local function becomeInvisible()
    if state.isInvisible then return end
    
    state.isInvisible = true
    local character = player.Character
    if not character then return end
    
    local originalProps = {}
    
    -- Make character transparent
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            originalProps[part] = {
                Transparency = part.Transparency,
                Material = part.Material
            }
            part.Transparency = 0.9
            part.Material = EnumMaterial.Glass
        end
    end
    
    -- Add ghost effect
    local ghostSound = Instance.new("Sound")
    ghostSound.SoundId = "rbxassetid://9114828336"
    ghostSound.Volume = 0.5
    ghostSound.Parent = character
    ghostSound:Play()
    
    trollButtons.trollBtn4.Text = "üëª INVISIBLE ACTIVE"
    trollButtons.trollBtn4.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
    
    statusText.Text = "üëª INVISIBILITY ACTIVATED!"
    
    task.wait(config.invisDuration)
    
    -- Restore character
    for part, props in pairs(originalProps) do
        if part.Parent then
            part.Transparency = props.Transparency
            part.Material = props.Material
        end
    end
    
    ghostSound:Destroy()
    state.isInvisible = false
    
    trollButtons.trollBtn4.Text = "4. INVISIBLE"
    trollButtons.trollBtn4.BackgroundColor3 = Color3.fromRGB(180, 0, 255)
    
    statusText.Text = "Invisibility ended"
    task.wait(1)
    updateUI()
end

-- 5. HIGH JUMP (Enhanced)
local function highJump()
    if state.isHighJump then return end
    
    state.isHighJump = true
    local character = player.Character
    if not character then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    if humanoid then
        original.jumpPower = humanoid.JumpPower
        humanoid.JumpPower = config.jumpPower * 2 -- Double jump power
        
        trollButtons.trollBtn5.Text = "ü¶ò HIGH JUMP ACTIVE"
        trollButtons.trollBtn5.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        
        -- Jump effect
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
        
        statusText.Text = "ü¶ò HIGH JUMP ACTIVATED!"
        
        task.wait(15)
        
        -- Restore jump power
        humanoid.JumpPower = original.jumpPower
        state.isHighJump = false
        
        trollButtons.trollBtn5.Text = "5. HIGH JUMP"
        trollButtons.trollBtn5.BackgroundColor3 = Color3.fromRGB(0, 200, 100)
        
        statusText.Text = "High jump ended"
        task.wait(1)
        updateUI()
    end
end

-- 6. GOD MODE (Invincibility)
local function godMode()
    state.godMode = not state.godMode
    local character = player.Character
    
    if character and state.godMode then
        local humanoid = character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.MaxHealth = math.huge
            humanoid.Health = math.huge
            
            -- Add aura effect
            local aura = Instance.new("Part")
            aura.Size = Vector3.new(10, 10, 10)
            aura.Position = character:GetPivot().Position
            aura.Anchored = true
            aura.CanCollide = false
            aura.Transparency = 0.7
            aura.Color = Color3.fromRGB(255, 255, 0)
            aura.Material = EnumMaterial.Neon
            aura.Shape = Enum.PartType.Ball
            aura.Parent = character
            
            trollButtons.trollBtn6.Text = "üõ°Ô∏è GOD MODE ACTIVE"
            trollButtons.trollBtn6.BackgroundColor3 = Color3.fromRGB(255, 255, 0)
            
            statusText.Text = "üõ°Ô∏è GOD MODE ACTIVATED!"
        end
    else
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                humanoid.MaxHealth = 100
                humanoid.Health = 100
            end
            
            -- Remove aura
            for _, child in pairs(character:GetChildren()) do
                if child.Name == "GodModeAura" then
                    child:Destroy()
                end
            end
        end
        
        trollButtons.trollBtn6.Text = "6. GOD MODE"
        trollButtons.trollBtn6.BackgroundColor3 = trollColors.primary
        
        statusText.Text = "God Mode disabled"
    end
    
    task.wait(1)
    updateUI()
end

-- 7. ANTI-AFK
local function antiAfk()
    state.antiAfk = not state.antiAfk
    
    if state.antiAfk then
        -- Simulate movement to prevent AFK
        local afkLoop = RunService.Heartbeat:Connect(function()
            if not state.antiAfk then
                afkLoop:Disconnect()
                return
            end
            
            local character = player.Character
            if character then
                local hrp = character:FindFirstChild("HumanoidRootPart")
                if hrp then
                    -- Slightly rotate to prevent AFK
                    hrp.CFrame = hrp.CFrame * CFrame.Angles(0, math.rad(1), 0)
                end
            end
        end)
        
        state.afkConnection = afkLoop
        trollButtons.trollBtn7.Text = "‚è∞ ANTI-AFK ACTIVE"
        trollButtons.trollBtn7.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        statusText.Text = "‚è∞ ANTI-AFK ACTIVATED!"
    else
        if state.afkConnection then
            state.afkConnection:Disconnect()
            state.afkConnection = nil
        end
        trollButtons.trollBtn7.Text = "7. ANTI-AFK"
        trollButtons.trollBtn7.BackgroundColor3 = Color3.fromRGB(0, 200, 200)
        statusText.Text = "Anti-AFK disabled"
    end
    
    task.wait(1)
    updateUI()
end

-- 8. ESP WALLS (See through walls)
local function espWalls()
    state.esp = not state.esp
    
    if state.esp then
        -- Store original properties
        local originalTransparency = {}
        
        for _, part in pairs(Workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.Transparency < 0.5 then
                originalTransparency[part] = part.Transparency
                part.Transparency = 0.7
            end
        end
        
        state.espData = originalTransparency
        
        trollButtons.trollBtn8.Text = "üëÅÔ∏è ESP ACTIVE"
        trollButtons.trollBtn8.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        statusText.Text = "üëÅÔ∏è ESP WALLS ACTIVATED!"
    else
        -- Restore original properties
        if state.espData then
            for part, transparency in pairs(state.espData) do
                if part.Parent then
                    part.Transparency = transparency
                end
            end
            state.espData = nil
        end
        
        trollButtons.trollBtn8.Text = "8. ESP WALLS"
        trollButtons.trollBtn8.BackgroundColor3 = Color3.fromRGB(200, 200, 0)
        statusText.Text = "ESP disabled"
    end
    
    task.wait(1)
    updateUI()
end
-- 9. AIMBOT (Auto-aim)
local function aimbot()
    state.aimbot = not state.aimbot
    
    if state.aimbot then
        trollButtons.trollBtn9.Text = "üéØ AIMBOT ACTIVE"
        trollButtons.trollBtn9.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        statusText.Text = "üéØ AIMBOT ACTIVATED!\nLooking for targets..."
        
        -- Aimbot loop
        local aimbotLoop = RunService.Heartbeat:Connect(function()
            if not state.aimbot then
                aimbotLoop:Disconnect()
                return
            end
            
            local character = player.Character
            if not character then return end
            
            local hrp = character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end
            
            -- Find closest player
            local closest = nil
            local closestDist = math.huge
            
            for _, targetPlayer in pairs(Players:GetPlayers()) do
                if targetPlayer ~= player and targetPlayer.Character then
                    local targetHrp = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
                    if targetHrp then
                        local dist = (targetHrp.Position - hrp.Position).Magnitude
                        if dist < closestDist and dist < 100 then
                            closestDist = dist
                            closest = targetHrp
                        end
                    end
                end
            end
            
            -- Aim at closest player
            if closest then
                local camera = Workspace.CurrentCamera
                camera.CFrame = CFrame.lookAt(camera.CFrame.Position, closest.Position)
            end
        end)
        
        state.aimbotConnection = aimbotLoop
    else
        if state.aimbotConnection then
            state.aimbotConnection:Disconnect()
            state.aimbotConnection = nil
        end
        
        trollButtons.trollBtn9.Text = "9. AIMBOT"
        trollButtons.trollBtn9.BackgroundColor3 = Color3.fromRGB(255, 0, 200)
        statusText.Text = "Aimbot disabled"
    end
    
    task.wait(1)
    updateUI()
end

-- 10. X-RAY VISION
local function xrayVision()
    state.xray = not state.xray
    
    if state.xray then
        -- Change lighting for X-ray effect
        original.brightness = Lighting.Brightness
        original.fogEnd = Lighting.FogEnd
        
        Lighting.Brightness = 2
        Lighting.FogEnd = 10000
        Lighting.Ambient = Color3.fromRGB(100, 100, 100)
        
        -- Make terrain semi-transparent
        if Workspace.Terrain then
            Workspace.Terrain.Transparency = 0.7
        end
        
        trollButtons.trollBtn10.Text = "üîç X-RAY ACTIVE"
        trollButtons.trollBtn10.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        statusText.Text = "üîç X-RAY VISION ACTIVATED!"
    else
        -- Restore lighting
        Lighting.Brightness = original.brightness
        Lighting.FogEnd = original.fogEnd
        Lighting.Ambient = Color3.fromRGB(0.5, 0.5, 0.5)
        
        -- Restore terrain
        if Workspace.Terrain then
            Workspace.Terrain.Transparency = 0
        end
        
        trollButtons.trollBtn10.Text = "10. X-RAY"
        trollButtons.trollBtn10.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
        statusText.Text = "X-Ray disabled"
    end
    
    task.wait(1)
    updateUI()
end

-- ============ 10 FLY MODE FUNCTIONS ============

-- 1. FLY MODE (already implemented)
-- 2. MARKERS (already implemented)
-- 3. VIEW MODE (already implemented)
-- 4. TELEPORT (already implemented)
-- 5. NO CLIP (already implemented)
-- 6. INFINITE JUMP (already implemented)

-- 7. SPEED CONTROL (Enhanced)
local function adjustFlySpeed(multiplier)
    state.speed = math.clamp(state.speed * multiplier, config.minSpeed, config.maxSpeed)
    speedLabel.Text = string.format("SPEED: %d", state.speed)
    statusText.Text = string.format("Speed set to: %d", state.speed)
    task.wait(1)
    updateFlyStatus()
end

-- 8. CAMERA SHAKE (Visual effect)
local function cameraShake(intensity)
    local camera = Workspace.CurrentCamera
    local originalPos = camera.CFrame
    
    for i = 1, 10 do
        local offset = Vector3.new(
            math.random(-intensity, intensity),
            math.random(-intensity, intensity),
            math.random(-intensity, intensity)
        ) / 100
        camera.CFrame = originalPos + offset
        task.wait(0.05)
    end
    
    camera.CFrame = originalPos
end

-- 9. FREEZE TIME (Slow motion)
local function freezeTime(duration)
    original.gravity = Workspace.Gravity
    Workspace.Gravity = 10
    
    statusText.Text = "‚è∞ TIME SLOWED!"
    
    task.wait(duration)
    
    Workspace.Gravity = original.gravity
    statusText.Text = "TimeÊÅ¢Â§çÊ≠£Â∏∏"
    task.wait(1)
    updateUI()
end

-- 10. FLY BOOST (Temporary speed burst)
local function flyBoost()
    if state.flyBoost then return end
    
    state.flyBoost = true
    local originalSpeed = state.speed
    state.speed = state.speed * 3
    
    -- Visual effect
    local character = player.Character
    if character then
        local boostEffect = Instance.new("Part")
        boostEffect.Size = Vector3.new(5, 5, 5)
        boostEffect.Position = character:GetPivot().Position
        boostEffect.Anchored = true
        boostEffect.CanCollide = false
        boostEffect.Transparency = 0.5
        boostEffect.Color = Color3.fromRGB(0, 255, 255)
        boostEffect.Material = EnumMaterial.Neon
        boostEffect.Parent = Workspace
        
        task.wait(3)
        boostEffect:Destroy()
    end
    
    task.wait(5)
    state.speed = originalSpeed
    state.flyBoost = false
    
    statusText.Text = "Fly boost ended"
    task.wait(1)
    updateFlyStatus()
end

-- Button event connections
modeBtn.MouseButton1Click:Connect(switchMode)
exitBtn.MouseButton1Click:Connect(function()
    if state.flying then
        stopFlying()
    elseif state.viewing then
        stopViewing()
    end
end)

-- Fly mode button events
flyButtons.flyBtn.MouseButton1Click:Connect(startFlying)
flyButtons.markBtn.MouseButton1Click:Connect(function()
    placeMarker(Workspace.CurrentCamera.CFrame.Position)
end)
flyButtons.viewBtn.MouseButton1Click:Connect(startViewing)
flyButtons.tpBtn.MouseButton1Click:Connect(teleportToCamera)
flyButtons.clearBtn.MouseButton1Click:Connect(clearMarkers)
flyButtons.noclipBtn.MouseButton1Click:Connect(toggleNoClip)
flyButtons.infJumpBtn.MouseButton1Click:Connect(toggleInfiniteJump)

-- Settings button (placeholder)
flyButtons.settingsBtn.MouseButton1Click:Connect(function()
    statusText.Text = "‚öôÔ∏è Settings panel coming soon!"
    task.wait(2)
    updateUI()
end)

-- Troll button events
trollButtons.trollBtn1.MouseButton1Click:Connect(teleportToPlayer)
trollButtons.trollBtn2.MouseButton1Click:Connect(superDash)
trollButtons.trollBtn3.MouseButton1Click:Connect(speedBoostX5)
trollButtons.trollBtn4.MouseButton1Click:Connect(becomeInvisible)
trollButtons.trollBtn5.MouseButton1Click:Connect(highJump)
trollButtons.trollBtn6.MouseButton1Click:Connect(godMode)
trollButtons.trollBtn7.MouseButton1Click:Connect(antiAfk)
trollButtons.trollBtn8.MouseButton1Click:Connect(espWalls)
trollButtons.trollBtn9.MouseButton1Click:Connect(aimbot)
trollButtons.trollBtn10.MouseButton1Click:Connect(xrayVision)

-- Fly control button events
teleportBtn.MouseButton1Click:Connect(teleportToCamera)
flyMarkBtn.MouseButton1Click:Connect(function()
    if state.flying then
        placeMarker(state.flyPos)
    end
end)

speedDown.MouseButton1Click:Connect(function() changeSpeed(-10) end)
speedUp.MouseButton1Click:Connect(function() changeSpeed(10) end)

prevBtn.MouseButton1Click:Connect(function() switchMarker("prev") end)
nextBtn.MouseButton1Click:Connect(function() switchMarker("next") end)

-- Movement control events
moveForward.MouseButton1Down:Connect(function() flyDir.forward = true end)
moveForward.MouseButton1Up:Connect(function() flyDir.forward = false end)
moveBack.MouseButton1Down:Connect(function() flyDir.back = true end)
moveBack.MouseButton1Up:Connect(function() flyDir.back = false end)
moveLeft.MouseButton1Down:Connect(function() flyDir.left = true end)
moveLeft.MouseButton1Up:Connect(function() flyDir.left = false end)
moveRight.MouseButton1Down:Connect(function() flyDir.right = true end)
moveRight.MouseButton1Up:Connect(function() flyDir.right = false end)
moveUp.MouseButton1Down:Connect(function() flyDir.up = true end)
moveUp.MouseButton1Up:Connect(function() flyDir.up = false end)
moveDown.MouseButton1Down:Connect(function() flyDir.down = true end)
moveDown.MouseButton1Up:Connect(function() flyDir.down = false end)
lookLeft.MouseButton1Down:Connect(function() camRot.left = true end)
lookLeft.MouseButton1Up:Connect(function() camRot.left = false end)
lookRight.MouseButton1Down:Connect(function() camRot.right = true end)
lookRight.MouseButton1Up:Connect(function() camRot.right = false end)

-- Main game loop
RunService.Heartbeat:Connect(function(delta)
    updateFPS()
    
    if state.mode == "fly" then
        if state.flying then
            local camera = Workspace.CurrentCamera
            
            -- Camera rotation
            if camRot.left then state.flyAng = Vector2.new(state.flyAng.X - 3 * delta, state.flyAng.Y) end
            if camRot.right then state.flyAng = Vector2.new(state.flyAng.X + 3 * delta, state.flyAng.Y) end
            state.flyAng = Vector2.new(state.flyAng.X, math.clamp(state.flyAng.Y, -1.4, 1.4))
            
            -- Movement calculation
            local yaw = state.flyAng.X
            local forward = Vector3.new(math.sin(yaw), 0, math.cos(yaw))
            local right = Vector3.new(math.cos(yaw), 0, -math.sin(yaw))
            
            local move = Vector3.new(0, 0, 0)
            if flyDir.forward then move = move + forward end
            if flyDir.back then move = move - forward end
            if flyDir.right then move = move + right end
            if flyDir.left then move = move - right end
            if flyDir.up then move = move + Vector3.new(0, 1, 0) end
            if flyDir.down then move = move - Vector3.new(0, 1, 0) end
            
            if move.Magnitude > 0 then
                state.flyPos = state.flyPos + move.Unit * state.speed * delta
            end
            
            -- Apply noclip during flight
            if state.flyNoClip then
                local character = player.Character
                if character then
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            part.CanCollide = false
                        end
                    end
                end
            end
            
            -- Update camera
            local look = Vector3.new(
                math.sin(yaw) * math.cos(state.flyAng.Y),
                -math.sin(state.flyAng.Y),
                math.cos(yaw) * math.cos(state.flyAng.Y)
            )
            
            camera.CFrame = CFrame.new(state.flyPos, state.flyPos + look)
            camera.FieldOfView = config.cameraFOV
            
        elseif state.viewing and #state.markers > 0 then
            local camera = Workspace.CurrentCamera
            local marker = state.markers[state.markerIndex]
            
            if marker then
                local distance = 10 * state.zoom
                local angle = state.viewAng
                
                local offset = Vector3.new(
                    math.sin(angle.X) * math.cos(angle.Y) * distance,
                    math.sin(angle.Y) * distance,
                    math.cos(angle.X) * math.cos(angle.Y) * distance
                )
                
                camera.CFrame = CFrame.new(marker.position + offset, marker.position)
                camera.FieldOfView = 70 / state.zoom
            end
        end
    end
    
    -- Update FPS counter every second
    if tick() % 1 < delta then
        updateUI()
    end
end)

-- Keyboard shortcuts
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.F then
        if state.mode == "fly" then
            startFlying()
        end
    elseif input.KeyCode == Enum.KeyCode.M then
        if state.mode == "fly" and not state.flying then
            placeMarker(Workspace.CurrentCamera.CFrame.Position)
        end
    elseif input.KeyCode == Enum.KeyCode.V then
        if state.mode == "fly" then
            if state.viewing then
                stopViewing()
            else
                startViewing()
            end
        end
    elseif input.KeyCode == Enum.KeyCode.T then
        if state.mode == "troll" then
            teleportToPlayer()
        end
    elseif input.KeyCode == Enum.KeyCode.Escape then
        if state.flying then
            stopFlying()
        elseif state.viewing then
            stopViewing()
        end
    end
end)

-- Initialize
updateUI()
print("==================================")
print("üöÄ ULTIMATE SYSTEM PRO v2.0 LOADED")
print("‚ú® Fly Mode: 10 Advanced Features")
print("üòà Troll Mode: 10 Demonic Powers")
print("==================================")
print("Shortcuts: F=Fly, M=Mark, V=View")
print("T=Teleport, Esc=Exit modes")

-- Cleanup on destroy
gui.Destroying:Connect(function()
    -- Clean up markers
    clearMarkers()
    markerFolder:Destroy()
    
    -- Restore original values
    if state.noclipConnection then
        state.noclipConnection:Disconnect()
    end
    
    if state.aimbotConnection then
        state.aimbotConnection:Disconnect()
    end
    
    if state.afkConnection then
        state.afkConnection:Disconnect()
    end
    
    -- Restore lighting
    Lighting.Brightness = original.brightness
    Lighting.FogEnd = original.fogEnd
    Workspace.Gravity = original.gravity
    
    print("Ultimate System Pro unloaded")
end)

-- Anti-detection
gui.Name = HttpService:GenerateGUID(false)
corner.Name = HttpService:GenerateGUID(false)
