-- [Soul Swap Desync] Steal-a-Brainrot Ultimate Hack | Custom UI
-- Fully new method. Inject and execute.

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- UI Library Load
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/RobloxianDev/Libraries/main/ModernUI.lua"))()

-- Main Window
local Window = Library:CreateWindow({
    Title = "Soul Swap Suite v3.0",
    SubTitle = "by Colin",
    MainColor = Color3.fromRGB(45, 0, 75),
    MinimizeKey = Enum.KeyCode.RightShift
})

-- Tabs
local MainTab = Window:CreateTab("Main")
local VisualTab = Window:CreateTab("Visual")
local SettingsTab = Window:CreateTab("Settings")

-- Variables
local SoulClone = nil
local OriginalBody = nil
local IsSoulInClone = false
local ClonePosition = Vector3.new(0,0,0)

-- Function to hijack the game's cloner
local function hijackClonerRemote()
    for _, v in pairs(getreg()) do
        if type(v) == 'function' and getinfo(v).name == "onCloneRequest" then
            local remote = getupvalue(v, 1)
            local originalFire = remote.FireServer
            remote.FireServer = function(self, ...)
                local args = {...}
                if args[1] == "create_clone" then
                    -- Intercept clone creation, store clone reference
                    SoulClone = workspace:FindFirstChild(LocalPlayer.Name .. "_Clone")
                    OriginalBody = LocalPlayer.Character
                    ClonePosition = OriginalBody.HumanoidRootPart.Position + Vector3.new(10,0,10)
                    if SoulClone then
                        SoulClone:MoveTo(ClonePosition)
                    end
                end
                return originalFire(self, unpack(args))
            end
            break
        end
    end
end

-- Function to swap "soul" (network ownership)
local function swapSoul()
    if not SoulClone or not OriginalBody then return end
    local networkOwner = getsenv(LocalPlayer.PlayerScripts.PlayerModule.ControlModule).GetRemoteEvent("UpdateCharacter")
    if IsSoulInClone then
        -- Soul returns to original body
        networkOwner:FireServer("set_origin", OriginalBody.HumanoidRootPart)
        IsSoulInClone = false
    else
        -- Soul goes to clone
        networkOwner:FireServer("set_origin", SoulClone.HumanoidRootPart)
        IsSoulInClone = true
    end
end

-- UI Elements
MainTab:AddToggle("Activate Soul Swap", false, function(state)
    if state then
        hijackClonerRemote()
        -- Trigger the game's native clone function
        game:GetService("ReplicatedStorage").CloneEvent:FireServer()
    else
        if SoulClone then SoulClone:Destroy() end
    end
end)

MainTab:AddButton("Create Clone", function()
    game:GetService("ReplicatedStorage").CloneEvent:FireServer()
end)

MainTab:AddButton("Swap Soul (KEY: F)", function()
    swapSoul()
end)

MainTab:AddSlider("Clone Distance", 5, 50, 20, function(value)
    ClonePosition = OriginalBody.HumanoidRootPart.Position + (OriginalBody.HumanoidRootPart.CFrame.LookVector * value)
    if SoulClone then
        SoulClone:MoveTo(ClonePosition)
    end
end)

MainTab:AddToggle("Auto-Steal Mode", false, function(state)
    -- Auto-steal logic: if soul is in clone and clone is near an item, automatically interact
end)

VisualTab:AddColorPicker("Menu Color", Color3.fromRGB(45, 0, 75), function(color)
    Window:UpdateColor(color)
end)

SettingsTab:AddKeybind("Toggle Menu Key", Enum.KeyCode.RightShift, function()
    Window:ToggleMinimize()
end)

-- Key listener for quick swap
UIS.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.F then
        swapSoul()
    end
end)

-- Loop to maintain clone position if not swapped
RunService.Heartbeat:Connect(function()
    if SoulClone and not IsSoulInClone then
        -- Keep clone at the set offset from original body
        if OriginalBody and OriginalBody:FindFirstChild("HumanoidRootPart") then
            local targetPos = OriginalBody.HumanoidRootPart.Position + (OriginalBody.HumanoidRootPart.CFrame.LookVector * 20)
            SoulClone:MoveTo(targetPos)
        end
    end
end)

Library:Init()
